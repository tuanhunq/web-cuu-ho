<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Cứu Hộ Quốc Gia</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap');
        :root {
            --primary: #ef4444;
            --primary-light: #fee2e2;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            scroll-behavior: smooth;
        }
        .emergency-btn {
            animation: pulse 1.5s infinite cubic-bezier(0.4, 0, 0.6, 1);
            transition: all 0.3s ease;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { transform: scale(1.03); box-shadow: 0 0 0 12px rgba(239, 68, 68, 0); }
        }
        #map {
            height: 500px;
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .service-card {
            transition: all 0.3s ease;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), #f97316);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .service-card:hover::before {
            opacity: 1;
        }
        .nav-link {
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }
        .nav-link:hover::after {
            width: 100%;
        }
        .hero-section {
            background: linear-gradient(135deg, rgba(254, 226, 226, 0.8) 0%, rgba(255, 255, 255, 1) 100%);
        }
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .scrollbar-thin::-webkit-scrollbar {
            width: 4px;
        }
        .scrollbar-thumb-gray-300::-webkit-scrollbar-thumb {
            background-color: #d1d5db;
            border-radius: 4px;
        }
        .scrollbar-track-gray-100::-webkit-scrollbar-track {
            background-color: #f3f4f6;
        }
        .custom-marker {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        .leaflet-popup-content {
            margin: 8px 12px;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .news-card {
            position: relative;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-50 backdrop-blur-sm bg-opacity-80">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                    <span class="text-2xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">CỨU HỘ QUỐC GIA</span>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#home" class="nav-link text-gray-700 hover:text-red-500 font-medium transition">Trang chủ</a>
                    <a href="emergency_map.html" class="nav-link text-gray-700 hover:text-red-500 font-medium transition">Bản đồ cứu hộ</a>
                    <a href="news.html" class="nav-link text-gray-700 hover:text-red-500 font-medium transition">Bản tin</a>
                    <a href="post.html" class="nav-link text-gray-700 hover:text-red-500 font-medium transition">Báo tin</a>
                    
                    <div class="flex space-x-4">
                        <a href="admin.html" class="bg-gray-800 hover:bg-gray-900 text-white px-4 py-2 rounded-lg font-medium transition-all shadow hover:shadow-lg">Admin</a>
                        <a href="login.html" class="bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-all shadow hover:shadow-lg">Đăng nhập</a>
                    </div>
                </div>
                <div class="md:hidden flex items-center">
                    <button id="menu-toggle" class="text-gray-700 hover:text-red-600">
                        <i data-feather="menu"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white py-2 px-4 shadow-lg">
            <a href="#home" class="block py-2 text-gray-700 hover:text-red-600 transition">Trang chủ</a>
            <a href="emergency_map.html" class="block py-2 text-gray-700 hover:text-red-600 transition">Bản đồ cứu hộ</a>
            <a href="news.html" class="block py-2 text-gray-700 hover:text-red-600 transition">Bản tin</a>
            <a href="post.html" class="block py-2 text-gray-700 hover:text-red-600 transition">Báo tin</a>
            <a href="admin.html" class="block py-2 text-white bg-gray-800 rounded-md text-center">Admin</a>
            <a href="login.html" class="block py-2 text-white bg-red-600 rounded-md text-center mt-2">Đăng nhập</a>
        </div>
    </nav>

    <!-- Emergency Alert Banner -->
    <div class="bg-gradient-to-r from-red-500 to-orange-500 text-white py-3 px-4 text-center animate-pulse">
        <div class="max-w-7xl mx-auto flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <span class="font-medium tracking-wide">CẢNH BÁO THIÊN TAI: Mưa lớn diện rộng tại miền Trung - Cập nhật lúc 14:30 15/06/2023</span>
        </div>
    </div>

    <!-- Hero Section -->
    <section id="home" class="hero-section py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row items-center">
                <div class="md:w-1/2 mb-10 md:mb-0">
                    <h1 class="text-4xl md:text-5xl font-bold leading-tight mb-6">
                        <span class="bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">Hệ Thống Cứu Hộ</span> <br>
                        <span class="text-gray-800">Ứng Phó Khẩn Cấp Quốc Gia</span>
                    </h1>
                    <p class="text-lg text-gray-600 mb-8 max-w-lg leading-relaxed">
                        Kết nối người dân với lực lượng cứu hộ trong các tình huống khẩn cấp như thiên tai, hỏa hoạn, tai nạn giao thông và các sự cố đe dọa tính mạng.
                    </p>
                    <div class="flex space-x-4">
                        <a href="post.html" class="emergency-btn bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white px-6 py-3 rounded-lg font-medium transition-all shadow-lg flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            BÁO KHẨN CẤP
                        </a>
                        <a href="emergency_map.html" class="border-2 border-red-500 text-red-500 hover:bg-red-50 px-6 py-3 rounded-lg font-medium transition-all shadow flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            XEM BẢN ĐỒ
                        </a>
                    </div>
                </div>
                <div class="md:w-1/2 flex justify-center">
                    <div class="relative">
                        <img src="https://images.unsplash.com/photo-1583324113626-70df0f4deaab?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80" alt="Emergency rescue team" class="rounded-2xl shadow-2xl w-full max-w-md transform rotate-1">
                        <div class="absolute -bottom-4 -right-4 bg-white p-3 rounded-lg shadow-lg">
                            <div class="flex items-center">
                                <div class="h-3 w-3 bg-red-500 rounded-full mr-2 animate-pulse"></div>
                                <span class="text-sm font-medium">Đang hoạt động 24/7</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section class="py-20 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-bold mb-4 bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">Dịch Vụ Cứu Hộ</h2>
                <p class="text-gray-600 max-w-2xl mx-auto text-lg">Các dịch vụ cứu hộ khẩn cấp luôn sẵn sàng hỗ trợ 24/7</p>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="service-card bg-white border border-gray-100 p-8 shadow-sm">
                    <div class="w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <h3 class="font-bold text-xl mb-3 text-gray-800">Thiên Tai</h3>
                    <p class="text-gray-600 leading-relaxed">Bão lụt, động đất, sạt lở đất và các hiện tượng thiên tai khác</p>
                </div>
                <div class="service-card bg-white border border-gray-100 p-8 shadow-sm">
                    <div class="w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z" />
                        </svg>
                    </div>
                    <h3 class="font-bold text-xl mb-3 text-gray-800">Hỏa Hoạn</h3>
                    <p class="text-gray-600 leading-relaxed">Cứu hỏa, ứng cứu các vụ cháy nổ, sự cố công nghiệp</p>
                </div>
                <div class="service-card bg-white border border-gray-100 p-8 shadow-sm">
                    <div class="w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                        </svg>
                    </div>
                    <h3 class="font-bold text-xl mb-3 text-gray-800">Giao Thông</h3>
                    <p class="text-gray-600 leading-relaxed">Tai nạn đường bộ, hàng không, hàng hải và đường sắt</p>
                </div>
                <div class="service-card bg-white border border-gray-100 p-8 shadow-sm">
                    <div class="w-16 h-16 bg-red-100 rounded-2xl flex items-center justify-center mb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                        </svg>
                    </div>
                    <h3 class="font-bold text-xl mb-3 text-gray-800">Y Tế</h3>
                    <p class="text-gray-600 leading-relaxed">Cấp cứu y tế, tai nạn lao động, sự cố sức khỏe</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Map Section -->
    <section id="map-section" class="py-20 bg-gradient-to-b from-gray-50 to-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-4 bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">
                    Bản Đồ Cứu Hộ
                </h2>
                <p class="text-gray-600 max-w-2xl mx-auto text-lg">
                    Theo dõi các điểm cứu hộ, sự cố và lực lượng ứng phó trong thời gian thực
                </p>
            </div>

            <!-- Bộ lọc và tìm kiếm -->
            <div class="mb-6 bg-white rounded-2xl shadow-lg p-6">
                <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between">
                    <!-- Tìm kiếm -->
                    <div class="flex-1 w-full lg:w-auto">
                        <div class="relative">
                            <i data-feather="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                            <input 
                                type="text" 
                                id="search-incidents" 
                                placeholder="Tìm kiếm sự cố, địa điểm..." 
                                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition"
                            >
                        </div>
                    </div>

                    <!-- Bộ lọc tỉnh thành -->
                    <div class="w-full lg:w-64">
                        <select id="province-filter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                            <option value="all">Tất cả tỉnh thành</option>
                            <option value="hanoi">Hà Nội</option>
                            <option value="hcm">TP.Hồ Chí Minh</option>
                            <option value="danang">Đà Nẵng</option>
                            <option value="hue">Thừa Thiên Huế</option>
                            <option value="nghean">Nghệ An</option>
                            <option value="thanhhoa">Thanh Hóa</option>
                            <option value="haiphong">Hải Phòng</option>
                            <option value="cantho">Cần Thơ</option>
                        </select>
                    </div>

                    <!-- Bộ lọc loại sự cố -->
                    <div class="w-full lg:w-64">
                        <select id="type-filter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                            <option value="all">Tất cả loại sự cố</option>
                            <option value="fire">Hỏa hoạn</option>
                            <option value="flood">Ngập lụt</option>
                            <option value="accident">Tai nạn giao thông</option>
                            <option value="disaster">Thiên tai</option>
                        </select>
                    </div>

                    <!-- Nút reset -->
                    <button id="reset-filters" class="px-6 py-3 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-xl transition flex items-center whitespace-nowrap">
                        <i data-feather="refresh-cw" class="mr-2 w-4 h-4"></i> Đặt lại
                    </button>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row gap-8">
                <!-- 🗺️ Bản đồ -->
                <div class="lg:w-2/3">
                    <div id="map" class="h-[600px] w-full rounded-2xl shadow-xl border border-gray-200"></div>

                    <!-- Controls -->
                    <div class="mt-4 flex flex-wrap gap-3 items-center justify-between">
                        <div class="flex flex-wrap gap-2">
                            <button id="locate-btn" class="bg-white border border-gray-300 px-4 py-2 rounded-lg flex items-center hover:bg-gray-50 transition shadow-sm">
                                <i data-feather="map-pin" class="mr-2 w-4 h-4"></i> Vị trí của tôi
                            </button>
                            <button id="zoom-in-btn" class="bg-white border border-gray-300 px-4 py-2 rounded-lg flex items-center hover:bg-gray-50 transition shadow-sm">
                                <i data-feather="zoom-in" class="mr-2 w-4 h-4"></i> Phóng to
                            </button>
                            <button id="zoom-out-btn" class="bg-white border border-gray-300 px-4 py-2 rounded-lg flex items-center hover:bg-gray-50 transition shadow-sm">
                                <i data-feather="zoom-out" class="mr-2 w-4 h-4"></i> Thu nhỏ
                            </button>
                        </div>
                        
                        <div class="flex items-center text-sm text-gray-600">
                            <div class="flex items-center mr-4">
                                <div class="w-3 h-3 bg-red-500 rounded-full mr-2 animate-pulse"></div>
                                <span>Đang xử lý</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                <span>Đã giải quyết</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 🔥 Panel thông tin -->
                <div class="lg:w-1/3">
                    <div class="bg-white rounded-2xl shadow-xl overflow-hidden sticky top-4">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-red-500 to-orange-500 p-6 text-white">
                            <h3 class="text-xl font-bold mb-2 flex items-center">
                                <i data-feather="activity" class="mr-2 w-5 h-5"></i>
                                Thống Kê Sự Cố
                            </h3>
                            <p class="text-red-100 text-sm">Cập nhật lúc: <span id="last-update">--:--:--</span></p>
                        </div>

                        <!-- Thống kê -->
                        <div class="p-6 border-b border-gray-200">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center p-4 bg-red-50 rounded-xl">
                                    <div class="text-2xl font-bold text-red-600" id="active-incidents">0</div>
                                    <div class="text-sm text-red-700 font-medium">Đang xử lý</div>
                                </div>
                                <div class="text-center p-4 bg-green-50 rounded-xl">
                                    <div class="text-2xl font-bold text-green-600" id="resolved-incidents">0</div>
                                    <div class="text-sm text-green-700 font-medium">Đã giải quyết</div>
                                </div>
                            </div>
                        </div>

                        <!-- Chú thích -->
                        <div class="p-6">
                            <h4 class="font-bold mb-4 text-gray-800 flex items-center">
                                <i data-feather="map" class="text-red-500 mr-2 w-4 h-4"></i>
                                Chú Thích Bản Đồ
                            </h4>

                            <div class="space-y-3">
                                <!-- Hỏa hoạn -->
                                <div class="flex items-center p-3 bg-red-50 rounded-lg border border-red-200 hover:bg-red-100 transition cursor-pointer" data-type="fire">
                                    <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center mr-3">
                                        <i data-feather="flame" class="text-white w-4 h-4"></i>
                                    </div>
                                    <div class="flex-1">
                                        <span class="font-semibold text-red-700">🔥 Hỏa hoạn</span>
                                        <p class="text-sm text-red-600">Cháy nhà, cháy rừng, nổ</p>
                                    </div>
                                    <div class="w-6 h-6 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold" id="count-fire">0</div>
                                </div>

                                <!-- Ngập lụt -->
                                <div class="flex items-center p-3 bg-blue-50 rounded-lg border border-blue-200 hover:bg-blue-100 transition cursor-pointer" data-type="flood">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                                        <i data-feather="droplet" class="text-white w-4 h-4"></i>
                                    </div>
                                    <div class="flex-1">
                                        <span class="font-semibold text-blue-700">💧 Ngập lụt</span>
                                        <p class="text-sm text-blue-600">Ngập nước, lũ quét</p>
                                    </div>
                                    <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold" id="count-flood">0</div>
                                </div>

                                <!-- Tai nạn giao thông -->
                                <div class="flex items-center p-3 bg-orange-50 rounded-lg border border-orange-200 hover:bg-orange-100 transition cursor-pointer" data-type="accident">
                                    <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center mr-3">
                                        <i data-feather="activity" class="text-white w-4 h-4"></i>
                                    </div>
                                    <div class="flex-1">
                                        <span class="font-semibold text-orange-700">🚗 Tai nạn giao thông</span>
                                        <p class="text-sm text-orange-600">TNGT đường bộ, đường sắt</p>
                                    </div>
                                    <div class="w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center text-white text-xs font-bold" id="count-accident">0</div>
                                </div>

                                <!-- Thiên tai -->
                                <div class="flex items-center p-3 bg-purple-50 rounded-lg border border-purple-200 hover:bg-purple-100 transition cursor-pointer" data-type="disaster">
                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center mr-3">
                                        <i data-feather="alert-octagon" class="text-white w-4 h-4"></i>
                                    </div>
                                    <div class="flex-1">
                                        <span class="font-semibold text-purple-700">🌪️ Thiên tai</span>
                                        <p class="text-sm text-purple-600">Bão lụt, sạt lở, động đất</p>
                                    </div>
                                    <div class="w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center text-white text-xs font-bold" id="count-disaster">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- News Section -->
    <section id="news-section" class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold mb-3 bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">Bản Tin Khẩn Cấp</h2>
                <p class="text-gray-600 max-w-xl mx-auto text-base">Cập nhật thông tin mới nhất về các sự cố, cảnh báo và hoạt động cứu hộ trên toàn quốc.</p>
            </div>

            <div id="news-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- News Cards sẽ được render động -->
            </div>

            <div class="text-center mt-10">
                <a href="news.html" class="inline-flex items-center px-6 py-3 border border-red-600 text-red-600 rounded-md hover:bg-red-50 transition font-medium">
                    Xem tất cả bản tin
                    <i data-feather="chevron-right" class="ml-2 w-4 h-4"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- Modal for news details -->
    <div id="news-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4 modal">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 id="modal-title" class="text-2xl font-bold"></h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-500">
                    <i data-feather="x"></i>
                </button>
            </div>
            <div id="modal-content" class="space-y-4"></div>
            <div class="mt-6 border-t pt-4 flex space-x-4">
                <a id="map-link" href="#" class="text-blue-600 hover:text-blue-800 flex items-center">
                    <i data-feather="map-pin" class="mr-2 w-4 h-4"></i> Xem trên bản đồ
                </a>
                <a href="post.html" class="text-orange-600 hover:text-orange-700 flex items-center">
                    <i data-feather="alert-triangle" class="mr-2 w-4 h-4"></i> Báo tin bổ sung
                </a>
                <button id="share-news" class="text-green-600 hover:text-green-700 flex items-center">
                    <i data-feather="share-2" class="mr-2 w-4 h-4"></i> Chia sẻ
                </button>
            </div>
            <div id="related-news" class="mt-6 border-t pt-4">
                <h4 class="font-bold mb-4">Tin liên quan</h4>
                <div class="space-y-2"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                <div>
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                        </svg>
                        <span class="text-2xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">CỨU HỘ QUỐC GIA</span>
                    </div>
                    <p class="text-gray-400 leading-relaxed">Kết nối người dân với lực lượng cứu hộ trong các tình huống khẩn cấp.</p>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Dịch Vụ</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Cứu hỏa</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Cứu hộ giao thông</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Y tế khẩn cấp</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Ứng phó thiên tai</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Liên Kết</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Bộ Công An</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Bộ Y Tế</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Ban Chỉ Đạo PCTT</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Cục Cứu Hộ Cứu Nạn</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Hỗ Trợ</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Câu hỏi thường gặp</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Hướng dẫn sử dụng</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Chính sách bảo mật</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Điều khoản dịch vụ</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-12 pt-8 text-center text-gray-400">
                <p>© 2023 Hệ Thống Cứu Hộ Quốc Gia. Bản quyền thuộc về Bộ Công An.</p>
            </div>
        </div>
    </footer>

    <!-- ✅ Leaflet -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        // Dữ liệu tin tức
        const newsData = [
            {
                title: "Đà Nẵng: Chủ động ứng phó thiên tai những tháng cuối năm",
                date: "2025-10-21",
                type: "thien-tai",
                location: "da-nang,mien-trung",
                img: "https://media.daidoanket.vn/w1280/uploaded/images/2025/10/18/8898fcf6-b66a-433c-908c-72eb18bbdeb1.jpg",
                content: "<p><strong>Tình hình:</strong> TP. Đà Nẵng đang hứng chịu thời tiết cực đoan, mưa lớn kéo dài gây sạt lở nghiêm trọng tại nhiều khu vực. Đáng chú ý, bờ biển phường Hội An Tây bị sóng đánh mạnh, sạt lở dài hơn 200m với vách đứng cao 5-6m, cây chắn sóng bật gốc, công trình ven biển nguy cơ sụp đổ. Tuyến đường ĐT606 (Km23+480) bị sụt lún sâu 18-30cm, dài 43m, vết nứt cắt ngang, taluy cao 50m có dấu hiệu trượt, đe dọa chia cắt giao thông miền núi.</p><p><strong>Thiệt hại ước tính:</strong> Chưa có con số thiệt hại cụ thể về người và tài sản. Các khu vực bị ảnh hưởng bao gồm sạt lở bờ biển sát khu dân cư và du lịch, đất cát cuốn trôi lớn, công trình nguy cơ sụp đổ, giao thông huyết mạch có nguy cơ đứt gãy hoàn toàn.</p><p><strong>Hành động ứng phó:</strong> UBND TP. Đà Nẵng ban hành Công điện số 07/CĐ-UBND, kích hoạt phương án ứng phó toàn diện trong 10 ngày tới và những tháng cuối năm 2025. Các biện pháp: theo dõi thời tiết, củng cố cảnh báo sớm, bố trí lực lượng canh gác, chốt chặn khu vực nguy cơ; chuẩn bị phương tiện cứu hộ theo phương châm \"4 tại chỗ\"; sơ tán dân vùng trũng thấp, ven biển; kiểm tra, vận hành hồ chứa, trạm bơm chống ngập; lực lượng vũ trang sẵn sàng hỗ trợ; tuyên truyền kỹ năng phòng tránh; kiểm tra công trình thi công và hệ thống thủy lợi, đê điều.</p><p><strong>Khuyến cáo:</strong> Người dân theo dõi bản tin dự báo, hạn chế di chuyển khi mưa lớn, di dời tài sản đến nơi cao ráo, đảm bảo an toàn tính mạng và tài sản. Chính quyền địa phương chuẩn bị phương án ứng phó, kiểm tra hệ thống tiêu thoát nước, cảnh giới khu vực sạt lở, hỗ trợ dân khi ngập lụt. Tăng cường tuyên truyền nâng cao nhận thức cộng đồng về phòng tránh thiên tai.</p><a href='https://thiennhienmoitruong.vn/da-nang-chu-dong-ung-pho-thien-tai-nhung-thang-cuoi-nam.html' target='_blank'>Nguồn gốc</a>"
            },
            {
                title: "Vai trò y tế cơ sở trong chăm sóc sức khỏe tinh thần cho cộng đồng sau thiên tai",
                date: "2025-10-21",
                type: "cuu-ho",
                location: "lao-cai,thai-nguyen,mien-bac",
                img: "https://benhvientamthanhanoi.com/wp-content/uploads/2025/10/image.jpeg",
                content: "<p><strong>Tình hình:</strong> Sau thiên tai như bão lũ năm 2024 tại Lào Cai và Thái Nguyên, người dân đối mặt với nỗi ám ảnh tinh thần kéo dài, bao gồm rối loạn stress sau sang chấn, lo âu, trầm cảm và 'lo âu khí hậu' ở giới trẻ. Theo WHO, tỷ lệ rối loạn tâm thần tăng đáng kể sau thiên tai, đặc biệt sau bão số 3 Yagi, với tác động lâu dài về mất mát tài sản, người thân và kế sinh nhai. Người dân thường âm thầm chịu đựng, thiếu thói quen tìm kiếm hỗ trợ tâm lý.</p><p><strong>Thiệt hại ước tính:</strong> Thiệt hại tinh thần không thể đo lường bằng con số cụ thể, nhưng nghiên cứu nhỏ của WHO sau bão Yagi cho thấy tác động đáng kể đến sức khỏe tâm thần, bao gồm lo âu và trầm cảm phổ biến. Tại Việt Nam, số lượng chuyên gia tâm thần ít so với dân số, dẫn đến dịch vụ chưa đáp ứng nhu cầu, với sự kỳ thị xã hội làm tăng thách thức.</p><p><strong>Hành động ứng phó:</strong> Y tế cơ sở đóng vai trò quan trọng trong chăm sóc sức khỏe tâm thần, với bác sĩ đa khoa và điều dưỡng có thể điều trị rối loạn phổ biến nếu được đào tạo. WHO khuyến nghị tích hợp đánh giá sức khỏe tâm thần vào ứng phó khẩn cấp, bao gồm đội phản ứng nhanh và dịch vụ hỗ trợ xã hội. Tình nguyện viên như CLB ca nô tại Lào Cai tham gia cứu hộ, vượt qua nỗi sợ để hỗ trợ cộng đồng.</p><p><strong>Khuyến cáo:</strong> Theo TS Angela Pratt (WHO), cần coi hỗ trợ tâm lý là phần không thể tách rời của ứng phó và phục hồi thiên tai, không chỉ sau khi đáp ứng nhu cầu vật chất. Đào tạo y tế cơ sở về nhận biết và hỗ trợ trầm cảm, lo âu; nâng cao năng lực tuyến huyện; tăng chuyên gia tâm thần để xây dựng hệ thống bền vững. Giảm kỳ thị xã hội và nghiên cứu sâu hơn về tác động tại Việt Nam.</p><a href='https://vov2.vov.vn/suc-khoe/vai-tro-y-te-co-so-trong-cham-soc-suc-khoe-tinh-than-cho-cong-dong-sau-thien-tai-55411' target='_blank'>Nguồn gốc</a>"
            },
            {
                title: "Tai nạn giao thông mới nhất 19/10/2025: xe cứu hộ gây tai nạn liên hoàn trên quốc lộ 26",
                date: "2025-10-19",
                type: "tai-nan",
                location: "dak-lak,tp-hcm,binh-dinh,tay-nguyen",
                img: "https://cdnphoto.dantri.com.vn/fT-JEopnjSnsEkgTdgpPSX-an_8=/thumb_w/1020/2025/10/19/z7132063905158f9b65fad4a12b3160200c0a32ca66181-edited-1760843872053.jpg",
                content: "<p><strong>Tình hình:</strong> Ngày 19/10/2025, xảy ra ba vụ tai nạn giao thông nghiêm trọng: Xe cứu hộ gây tai nạn liên hoàn tại km146+400 quốc lộ 26 (Đắk Lắk), người đàn ông tử vong do mất lái xe máy ở dốc cầu Bình Lợi (TP Hồ Chí Minh), và xe máy va chạm xe tải chở gỗ khiến cô gái tử vong trên tỉnh lộ 639 (Bình Định).</p><p><strong>Thiệt hại ước tính:</strong> - Vụ quốc lộ 26: 3 phương tiện hư hỏng, không thiệt hại về người. - Vụ cầu Bình Lợi: 1 người đàn ông tử vong, xe máy hư hỏng. - Vụ tỉnh lộ 639: 1 cô gái (SN 2001) tử vong tại chỗ, xe máy hư hỏng.</p><p><strong>Hành động ứng phó:</strong> Công an xã Tuy Phước Đông bảo vệ hiện trường, đảm bảo an toàn giao thông và phối hợp điều tra vụ tỉnh lộ 639. Các vụ khác chưa ghi nhận hành động cụ thể.</p><p><strong>Khuyến cáo:</strong> Không có khuyến cáo được đề cập trong nội dung.</p><a href='https://baomoi.com/tai-nan-giao-thong-moi-nhat-19-10-2025-xe-cuu-ho-gay-tai-nan-lien-hoan-tren-quoc-lo-26-c53531244.epi' target='_blank'>Nguồn gốc</a>"
            },
            {
                title: "Thiên tai đã vượt quá sức chịu đựng của người dân",
                date: "2025-10-10",
                type: "thien-tai",
                location: "thai-nguyen,bac-ninh,cao-bang,lang-son,mien-bac,mien-trung",
                img: "https://premedia.vneconomy.vn/files/uploads/2025/10/10/c999b83a970f40588b4d060116ebed76-20061.png?w=900",
                content: "<p><strong>Tình hình:</strong> Năm 2025, Việt Nam xảy ra 20 loại hình thiên tai với diễn biến dồn dập, khốc liệt, bất thường, vượt mức lịch sử, ảnh hưởng rộng lớn đến miền Bắc và miền Trung. Các cơn bão di chuyển nhanh trên biển nhưng chậm trên đất liền, gây mưa lớn kéo dài; mực nước lũ vượt lịch sử tại nhiều sông (như sông Thương, sông Lô, sông Bưởi); hình thành 'bão chồng bão, lũ chồng lũ' kèm lũ quét, sạt lở đất, ngập lụt nghiêm trọng tại đô thị và vùng trũng thấp.</p><p><strong>Thiệt hại ước tính:</strong> 238 người chết và mất tích, 367 người bị thương; gần 260.000 ngôi nhà hư hỏng, tốc mái; gần 556.000 ha lúa, hoa màu và cây trồng ngập úng; hơn 15.000 con gia súc và 1,45 triệu con gia cầm chết hoặc cuốn trôi; hơn 40.000 ha nuôi trồng thủy sản bị ảnh hưởng. Tổng thiệt hại gần 34 nghìn tỷ đồng (tương đương 47% thiệt hại về người và 37% thiệt hại kinh tế so với năm 2024).</p><p><strong>Hành động ứng phó:</strong> Bộ Nông nghiệp và Môi trường tổ chức họp Đối tác giảm nhẹ rủi ro thiên tai để cập nhật tình hình, đánh giá thiệt hại nhanh và lập kế hoạch tái thiết; thành lập 3 đoàn khảo sát thực địa tại Tuyên Quang - Phú Thọ, Cao Bằng - Lạng Sơn, Bắc Ninh - Thái Nguyên. Chính phủ triển khai biện pháp ứng phó, chính sách hỗ trợ khắc phục; kêu gọi hỗ trợ từ đối tác quốc tế (Liên hợp quốc, UNICEF, WHO, IOM) với cam kết huy động nguồn lực, cung cấp hàng cứu trợ (lương thực, nước uống, nước, thuốc men). Năm 2024, đối tác hỗ trợ 25 triệu USD và hàng nghìn tấn hàng hóa.</p><p><strong>Khuyến cáo:</strong> Đầu tư vào chuẩn bị và ứng phó rủi ro thiên tai, giảm thiểu và xây dựng khả năng phục hồi; hành động tập thể để hỗ trợ khẩn cấp các địa phương bị ảnh hưởng nặng, tập trung khôi phục nhà ở và sản xuất; các tổ chức quốc tế tham gia khảo sát và đánh giá nhu cầu cứu trợ kịp thời.</p><a href='https://vneconomy.vn/thien-tai-da-vuot-qua-suc-chiu-dung-cua-nguoi-dan.htm' target='_blank'>Nguồn gốc</a>"
            }
        ];

        // Hàm timeAgo
        function timeAgo(dateString) {
            const now = new Date();
            const date = new Date(dateString);
            const seconds = Math.floor((now - date) / 1000);
            let interval = Math.floor(seconds / 31536000);
            if (interval > 1) return `${interval} năm trước`;
            interval = Math.floor(seconds / 2592000);
            if (interval > 1) return `${interval} tháng trước`;
            interval = Math.floor(seconds / 86400);
            if (interval > 1) return `${interval} ngày trước`;
            interval = Math.floor(seconds / 3600);
            if (interval > 1) return `${interval} giờ trước`;
            interval = Math.floor(seconds / 60);
            if (interval > 1) return `${interval} phút trước`;
            return "Vừa xong";
        }

        // Render news cards
        function renderNews() {
            const grid = document.getElementById('news-grid');
            grid.innerHTML = '';
            const sortedData = newsData.sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 4); // Lấy 4 tin mới nhất
            sortedData.forEach(news => {
                const badgeColor = news.type === 'thien-tai' ? 'bg-blue-600' : news.type === 'tai-nan' ? 'bg-red-600' : news.type === 'cuu-ho' ? 'bg-green-600' : 'bg-yellow-600';
                const badgeText = news.type === 'thien-tai' ? 'Thiên tai' : news.type === 'tai-nan' ? 'Tai nạn' : news.type === 'cuu-ho' ? 'Cứu hộ' : 'Cảnh báo';
                const locBadge = news.location.split(',')[0].replace('-', ' ').toUpperCase();
                const card = document.createElement('div');
                card.className = 'news-card bg-white rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1';
                card.dataset.type = news.type;
                card.dataset.location = news.location;
                card.innerHTML = `
                    <div class="relative">
                        <img src="${news.img}" alt="${news.title}" class="w-full h-40 object-cover" loading="lazy">
                        <span class="absolute top-3 left-3 ${badgeColor} text-white text-xs px-2 py-1 rounded-full font-bold">${badgeText}</span>
                        <span class="absolute top-3 right-3 bg-purple-600 text-white text-xs px-2 py-1 rounded-full font-bold">${locBadge}</span>
                    </div>
                    <div class="p-5">
                        <div class="flex items-center text-sm text-gray-500 mb-2">
                            <i data-feather="clock" class="mr-1 w-4 h-4"></i>
                            <span>${timeAgo(news.date)}</span>
                        </div>
                        <h3 class="text-lg font-bold mb-2">${news.title}</h3>
                        <p class="text-gray-600 mb-3 text-sm">${news.content.replace(/<[^>]+>/g, '').substring(0, 80)}...</p>
                        <button onclick="openModal(${newsData.indexOf(news)})" class="text-red-600 hover:text-red-800 font-medium flex items-center text-sm">
                            Xem chi tiết
                            <i data-feather="arrow-right" class="ml-1 w-4 h-4"></i>
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
            feather.replace();
        }

        // Skeleton loading
        function showSkeleton() {
            const grid = document.getElementById('news-grid');
            grid.innerHTML = '';
            for (let i = 0; i < 4; i++) {
                const skeletonCard = document.createElement('div');
                skeletonCard.className = 'news-card bg-white rounded-xl overflow-hidden shadow-md';
                skeletonCard.innerHTML = `
                    <div class="w-full h-40 skeleton"></div>
                    <div class="p-5">
                        <div class="h-4 w-24 skeleton mb-2"></div>
                        <div class="h-6 w-full skeleton mb-2"></div>
                        <div class="h-4 w-3/4 skeleton mb-3"></div>
                        <div class="h-4 w-32 skeleton"></div>
                    </div>
                `;
                grid.appendChild(skeletonCard);
            }
        }

        // Modal functions
        function openModal(index) {
            const news = newsData[index];
            const modal = document.getElementById('news-modal');
            document.getElementById('modal-title').textContent = news.title;
            document.getElementById('modal-content').innerHTML = `<img src="${news.img}" alt="${news.title}" class="w-full h-48 object-cover rounded-md mb-4">${news.content}`;
            document.getElementById('map-link').href = `index.html#map?location=${news.location.split(',')[0]}`;
            // Related news (tối đa 5 để đồng bộ với news.html)
            const related = document.getElementById('related-news').querySelector('.space-y-2');
            related.innerHTML = '';
            newsData.filter((n, i) => i !== index && n.type === news.type).slice(0, 5).forEach(n => {
                const link = document.createElement('a');
                link.href = '#';
                link.onclick = () => { closeModal(); openModal(newsData.indexOf(n)); return false; };
                link.className = 'block text-sm text-gray-700 hover:text-red-600';
                link.textContent = `→ ${n.title}`;
                related.appendChild(link);
            });
            // Share button
            document.getElementById('share-news').onclick = () => {
                if (navigator.share) {
                    navigator.share({
                        title: news.title,
                        text: news.content.replace(/<[^>]+>/g, '').substring(0, 100) + '...',
                        url: window.location.href
                    });
                } else {
                    alert('Chức năng chia sẻ không được hỗ trợ trên thiết bị này.');
                }
            };
            modal.classList.remove('hidden');
        }
        
        function closeModal() {
            document.getElementById('news-modal').classList.add('hidden');
        }
        
        document.getElementById('close-modal').addEventListener('click', closeModal);

        // Khởi tạo
        showSkeleton();
        setTimeout(() => {
            renderNews();
        }, 500);

        // Map functionality
        document.addEventListener("DOMContentLoaded", () => {
            // 🔹 Tọa độ trung tâm các tỉnh thành
            const provinceCoordinates = {
                'hanoi': [21.0278, 105.8342],
                'hcm': [10.8231, 106.6297],
                'danang': [16.0544, 108.2022],
                'hue': [16.4637, 107.5909],
                'nghean': [18.6796, 105.6813],
                'thanhhoa': [19.8076, 105.7766],
                'haiphong': [20.8449, 106.6881],
                'cantho': [10.0452, 105.7469],
                'sonla': [21.3257, 103.9160],
                'ninhbinh': [20.2506, 105.9745]
            };

            // 🔹 Dữ liệu sự cố mẫu với tỉnh thành
            const emergencies = [
                { id: 1, name: "Cháy nhà dân", address: "Số 35 Trần Hưng Đạo, Hoàn Kiếm, Hà Nội", coords: [21.027, 105.85], type: "fire", province: "hanoi", status: "active", time: "10 phút trước" },
                { id: 2, name: "Ngập lụt khu dân cư", address: "Khu vực Định Công, Hoàng Mai, Hà Nội", coords: [20.98, 105.84], type: "flood", province: "hanoi", status: "active", time: "25 phút trước" },
                { id: 3, name: "Tai nạn giao thông", address: "QL1A - Phường Tân Tạo, Bình Tân, TP.HCM", coords: [10.76, 106.62], type: "accident", province: "hcm", status: "resolved", time: "1 giờ trước" },
                { id: 4, name: "Sạt lở đất", address: "Huyện Mường La, Sơn La", coords: [21.41, 104.11], type: "disaster", province: "sonla", status: "active", time: "2 giờ trước" },
                { id: 5, name: "Cháy rừng", address: "Vườn Quốc Gia Cúc Phương, Ninh Bình", coords: [20.31, 105.61], type: "fire", province: "ninhbinh", status: "active", time: "3 giờ trước" },
                { id: 6, name: "Ngập cục bộ", address: "Đường Nguyễn Văn Linh, Đà Nẵng", coords: [16.06, 108.21], type: "flood", province: "danang", status: "resolved", time: "4 giờ trước" }
            ];

            // 🗺️ Khởi tạo bản đồ
            const map = L.map("map").setView([16.0471, 108.2068], 6);
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>'
            }).addTo(map);

            let currentMarkers = [];
            let currentFilters = { type: 'all', province: 'all', search: '' };

            // 🔹 Hàm cập nhật thống kê
            function updateStatistics() {
                const active = emergencies.filter(e => e.status === 'active').length;
                const resolved = emergencies.filter(e => e.status === 'resolved').length;
                
                document.getElementById('active-incidents').textContent = active;
                document.getElementById('resolved-incidents').textContent = resolved;
                
                // Cập nhật số lượng theo loại
                document.querySelectorAll('[id^="count-"]').forEach(el => {
                    const type = el.id.replace('count-', '');
                    const count = emergencies.filter(e => e.type === type).length;
                    el.textContent = count;
                });

                // Cập nhật thời gian
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString('vi-VN');
            }

            // 🔹 Hàm lọc sự cố
            function filterEmergencies() {
                return emergencies.filter(emg => {
                    const typeMatch = currentFilters.type === 'all' || emg.type === currentFilters.type;
                    const provinceMatch = currentFilters.province === 'all' || emg.province === currentFilters.province;
                    const searchMatch = currentFilters.search === '' || 
                        emg.name.toLowerCase().includes(currentFilters.search.toLowerCase()) ||
                        emg.address.toLowerCase().includes(currentFilters.search.toLowerCase());
                    
                    return typeMatch && provinceMatch && searchMatch;
                });
            }

            // 🔹 Hàm chuyển đến tỉnh thành
            function flyToProvince(provinceCode) {
                if (provinceCode === 'all') {
                    // Trở về bản đồ Việt Nam
                    map.flyTo([16.0471, 108.2068], 6, {
                        duration: 1.5,
                        easeLinearity: 0.25
                    });
                } else if (provinceCoordinates[provinceCode]) {
                    // Bay đến tỉnh thành cụ thể
                    const coords = provinceCoordinates[provinceCode];
                    map.flyTo(coords, 11, {
                        duration: 1.5,
                        easeLinearity: 0.25
                    });
                    
                    // Thêm marker trung tâm tỉnh
                    const provinceMarker = L.marker(coords)
                        .addTo(map)
                        .bindPopup(`<b>${getProvinceName(provinceCode)}</b><br>Đang hiển thị sự cố trong khu vực`)
                        .openPopup();
                    
                    // Tự động xóa marker sau 3 giây
                    setTimeout(() => {
                        map.removeLayer(provinceMarker);
                    }, 3000);
                }
            }

            // 🔹 Hàm vẽ marker
            function drawMarkers() {
                // Xóa marker cũ
                currentMarkers.forEach(marker => map.removeLayer(marker));
                currentMarkers = [];

                const filteredEmergencies = filterEmergencies();
                
                filteredEmergencies.forEach(emg => {
                    const color = getColorByType(emg.type);
                    const icon = getIconByType(emg.type);
                    
                    const marker = L.marker(emg.coords, {
                        icon: L.divIcon({
                            html: `
                                <div class="relative">
                                    <div class="w-10 h-10 bg-${color}-500 rounded-full flex items-center justify-center text-white shadow-lg border-2 border-white transform hover:scale-110 transition-transform cursor-pointer ${emg.status === 'resolved' ? 'opacity-70' : ''}">
                                        <span class="text-lg">${icon}</span>
                                    </div>
                                    ${emg.status === 'active' ? '<div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>' : ''}
                                </div>
                            `,
                            className: 'custom-marker',
                            iconSize: [40, 40],
                            iconAnchor: [20, 20]
                        })
                    })
                    .addTo(map)
                    .bindPopup(`
                        <div class="p-3 min-w-[250px]">
                            <div class="flex items-center mb-2">
                                <div class="w-6 h-6 bg-${color}-500 rounded-full flex items-center justify-center mr-2 text-white">
                                    <span>${icon}</span>
                                </div>
                                <h4 class="font-bold text-gray-800">${emg.name}</h4>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${emg.address}</p>
                            <div class="flex justify-between items-center text-xs">
                                <span class="px-2 py-1 bg-${color}-100 text-${color}-700 rounded">${getTypeName(emg.type)}</span>
                                <span class="text-gray-500">${emg.time}</span>
                            </div>
                            <div class="mt-3 flex gap-2">
                                <button onclick="viewEmergencyDetail(${emg.id})" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition">
                                    Chi tiết
                                </button>
                                <button onclick="shareEmergency(${emg.id})" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition">
                                    Chia sẻ
                                </button>
                            </div>
                        </div>
                    `);

                    currentMarkers.push(marker);
                });

                updateStatistics();
            }

            // 🔹 Hàm hỗ trợ
            function getColorByType(type) {
                const colors = {
                    fire: 'red', flood: 'blue', accident: 'orange', 
                    disaster: 'purple'
                };
                return colors[type] || 'gray';
            }

            function getIconByType(type) {
                const icons = {
                    fire: '🔥', flood: '💧', accident: '🚗', 
                    disaster: '🌪️'
                };
                return icons[type] || '⚠️';
            }

            function getTypeName(type) {
                const names = {
                    fire: 'Hỏa hoạn', flood: 'Ngập lụt', accident: 'Tai nạn', 
                    disaster: 'Thiên tai'
                };
                return names[type] || 'Khác';
            }

            function getProvinceName(code) {
                const names = {
                    'hanoi': 'Hà Nội',
                    'hcm': 'TP. Hồ Chí Minh',
                    'danang': 'Đà Nẵng',
                    'hue': 'Thừa Thiên Huế',
                    'nghean': 'Nghệ An',
                    'thanhhoa': 'Thanh Hóa',
                    'haiphong': 'Hải Phòng',
                    'cantho': 'Cần Thơ',
                    'sonla': 'Sơn La',
                    'ninhbinh': 'Ninh Bình'
                };
                return names[code] || code;
            }

            // 🔹 Event Listeners
            document.getElementById('type-filter').addEventListener('change', (e) => {
                currentFilters.type = e.target.value;
                drawMarkers();
            });

            document.getElementById('province-filter').addEventListener('change', (e) => {
                currentFilters.province = e.target.value;
                flyToProvince(e.target.value);
                drawMarkers();
            });

            document.getElementById('search-incidents').addEventListener('input', (e) => {
                currentFilters.search = e.target.value;
                drawMarkers();
            });

            document.getElementById('reset-filters').addEventListener('click', () => {
                currentFilters = { type: 'all', province: 'all', search: '' };
                document.getElementById('type-filter').value = 'all';
                document.getElementById('province-filter').value = 'all';
                document.getElementById('search-incidents').value = '';
                flyToProvince('all');
                drawMarkers();
            });

            // Click vào chú thích để lọc
            document.querySelectorAll('[data-type]').forEach(item => {
                item.addEventListener('click', () => {
                    currentFilters.type = item.dataset.type;
                    document.getElementById('type-filter').value = currentFilters.type;
                    drawMarkers();
                });
            });

            // Map controls
            document.getElementById('locate-btn').addEventListener('click', () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(pos => {
                        const lat = pos.coords.latitude;
                        const lng = pos.coords.longitude;
                        map.flyTo([lat, lng], 13, {
                            duration: 1.5
                        });
                        L.marker([lat, lng]).addTo(map)
                            .bindPopup("📍 Vị trí của bạn")
                            .openPopup();
                    }, () => {
                        alert("Không thể lấy vị trí của bạn. Vui lòng kiểm tra quyền truy cập vị trí.");
                    });
                } else {
                    alert("Trình duyệt không hỗ trợ định vị!");
                }
            });

            document.getElementById('zoom-in-btn').addEventListener('click', () => {
                map.zoomIn();
            });

            document.getElementById('zoom-out-btn').addEventListener('click', () => {
                map.zoomOut();
            });

            // 🔹 Khởi tạo
            drawMarkers();
            updateStatistics();

            // Cập nhật thời gian thực mỗi 30 giây
            setInterval(updateStatistics, 30000);
        });

        // Hàm toàn cục để sử dụng trong popup
        function viewEmergencyDetail(id) {
            alert(`Xem chi tiết sự cố #${id}`);
            // Có thể mở modal chi tiết ở đây
        }

        function shareEmergency(id) {
            if (navigator.share) {
                navigator.share({
                    title: 'Thông tin sự cố khẩn cấp',
                    text: 'Có sự cố khẩn cấp cần hỗ trợ',
                    url: window.location.href
                });
            } else {
                alert('Chức năng chia sẻ không được hỗ trợ');
            }
        }

        // Mobile menu toggle
        document.getElementById('menu-toggle').addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
            
            // Change icon based on state
            const isHidden = menu.classList.contains('hidden');
            this.innerHTML = isHidden ? feather.icons.menu.toSvg() : feather.icons.x.toSvg();
            feather.replace();
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                if(this.getAttribute('href') !== '#login') {
                    e.preventDefault();
                    
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                    
                    // Close mobile menu if open
                    const mobileMenu = document.getElementById('mobile-menu');
                    if (!mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                        document.getElementById('menu-toggle').innerHTML = feather.icons.menu.toSvg();
                        feather.replace();
                    }
                }
            });
        });

        // Initialize feather icons
        feather.replace();
    </script>
</body>
</html>