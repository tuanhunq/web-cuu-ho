const newsData = [
    {
        title: "Đà Nẵng: Chủ động ứng phó thiên tai những tháng cuối năm",
        date: "2025-10-21",
        type: "thien-tai",
        location: "da-nang,mien-trung",
        img: "https://media.daidoanket.vn/w1280/uploaded/images/2025/10/18/8898fcf6-b66a-433c-908c-72eb18bbdeb1.jpg",
        content: "<p><strong>Tình hình:</strong> TP. Đà Nẵng đang hứng chịu thời tiết cực đoan, mưa lớn kéo dài gây sạt lở nghiêm trọng tại nhiều khu vực. Đáng chú ý, bờ biển phường Hội An Tây bị sóng đánh mạnh, sạt lở dài hơn 200m với vách đứng cao 5-6m, cây chắn sóng bật gốc, công trình ven biển nguy cơ sụp đổ. Tuyến đường ĐT606 (Km23+480) bị sụt lún sâu 18-30cm, dài 43m, vết nứt cắt ngang, taluy cao 50m có dấu hiệu trượt, đe dọa chia cắt giao thông miền núi.</p><p><strong>Thiệt hại ước tính:</strong> Chưa có con số thiệt hại cụ thể về người và tài sản. Các khu vực bị ảnh hưởng bao gồm sạt lở bờ biển sát khu dân cư và du lịch, đất cát cuốn trôi lớn, công trình nguy cơ sụp đổ, giao thông huyết mạch có nguy cơ đứt gãy hoàn toàn.</p><p><strong>Hành động ứng phó:</strong> UBND TP. Đà Nẵng ban hành Công điện số 07/CĐ-UBND, kích hoạt phương án ứng phó toàn diện trong 10 ngày tới và những tháng cuối năm 2025. Các biện pháp: theo dõi thời tiết, củng cố cảnh báo sớm, bố trí lực lượng canh gác, chốt chặn khu vực nguy cơ; chuẩn bị phương tiện cứu hộ theo phương châm \"4 tại chỗ\"; sơ tán dân vùng trũng thấp, ven biển; kiểm tra, vận hành hồ chứa, trạm bơm chống ngập; lực lượng vũ trang sẵn sàng hỗ trợ; tuyên truyền kỹ năng phòng tránh; kiểm tra công trình thi công và hệ thống thủy lợi, đê điều.</p><p><strong>Khuyến cáo:</strong> Người dân theo dõi bản tin dự báo, hạn chế di chuyển khi mưa lớn, di dời tài sản đến nơi cao ráo, đảm bảo an toàn tính mạng và tài sản. Chính quyền địa phương chuẩn bị phương án ứng phó, kiểm tra hệ thống tiêu thoát nước, cảnh giới khu vực sạt lở, hỗ trợ dân khi ngập lụt. Tăng cường tuyên truyền nâng cao nhận thức cộng đồng về phòng tránh thiên tai.</p><a href='https://thiennhienmoitruong.vn/da-nang-chu-dong-ung-pho-thien-tai-nhung-thang-cuoi-nam.html' target='_blank'>Nguồn gốc</a>"
    },
    {
        title: "Vai trò y tế cơ sở trong chăm sóc sức khỏe tinh thần cho cộng đồng sau thiên tai",
        date: "2025-10-21",
        type: "cuu-ho",
        location: "lao-cai,thai-nguyen,mien-bac",
        img: "https://benhvientamthanhanoi.com/wp-content/uploads/2025/10/image.jpeg",
        content: "<p><strong>Tình hình:</strong> Sau thiên tai như bão lũ năm 2024 tại Lào Cai và Thái Nguyên, người dân đối mặt với nỗi ám ảnh tinh thần kéo dài, bao gồm rối loạn stress sau sang chấn, lo âu, trầm cảm và 'lo âu khí hậu' ở giới trẻ. Theo WHO, tỷ lệ rối loạn tâm thần tăng đáng kể sau thiên tai, đặc biệt sau bão số 3 Yagi, với tác động lâu dài về mất mát tài sản, người thân và kế sinh nhai. Người dân thường âm thầm chịu đựng, thiếu thói quen tìm kiếm hỗ trợ tâm lý.</p><p><strong>Thiệt hại ước tính:</strong> Thiệt hại tinh thần không thể đo lường bằng con số cụ thể, nhưng nghiên cứu nhỏ của WHO sau bão Yagi cho thấy tác động đáng kể đến sức khỏe tâm thần, bao gồm lo âu và trầm cảm phổ biến. Tại Việt Nam, số lượng chuyên gia tâm thần ít so với dân số, dẫn đến dịch vụ chưa đáp ứng nhu cầu, với sự kỳ thị xã hội làm tăng thách thức.</p><p><strong>Hành động ứng phó:</strong> Y tế cơ sở đóng vai trò quan trọng trong chăm sóc sức khỏe tâm thần, với bác sĩ đa khoa và điều dưỡng có thể điều trị rối loạn phổ biến nếu được đào tạo. WHO khuyến nghị tích hợp đánh giá sức khỏe tâm thần vào ứng phó khẩn cấp, bao gồm đội phản ứng nhanh và dịch vụ hỗ trợ xã hội. Tình nguyện viên như CLB ca nô tại Lào Cai tham gia cứu hộ, vượt qua nỗi sợ để hỗ trợ cộng đồng.</p><p><strong>Khuyến cáo:</strong> Theo TS Angela Pratt (WHO), cần coi hỗ trợ tâm lý là phần không thể tách rời của ứng phó và phục hồi thiên tai, không chỉ sau khi đáp ứng nhu cầu vật chất. Đào tạo y tế cơ sở về nhận biết và hỗ trợ trầm cảm, lo âu; nâng cao năng lực tuyến huyện; tăng chuyên gia tâm thần để xây dựng hệ thống bền vững. Giảm kỳ thị xã hội và nghiên cứu sâu hơn về tác động tại Việt Nam.</p><a href='https://vov2.vov.vn/suc-khoe/vai-tro-y-te-co-so-trong-cham-soc-suc-khoe-tinh-than-cho-cong-dong-sau-thien-tai-55411' target='_blank'>Nguồn gốc</a>"
    },
    {
        title: "Tai nạn giao thông mới nhất 19/10/2025: xe cứu hộ gây tai nạn liên hoàn trên quốc lộ 26",
        date: "2025-10-19",
        type: "tai-nan",
        location: "dak-lak,tp-hcm,binh-dinh,tay-nguyen",
        img: "https://cdnphoto.dantri.com.vn/fT-JEopnjSnsEkgTdgpPSX-an_8=/thumb_w/1020/2025/10/19/z7132063905158f9b65fad4a12b3160200c0a32ca66181-edited-1760843872053.jpg",
        content: "<p><strong>Tình hình:</strong> Ngày 19/10/2025, xảy ra ba vụ tai nạn giao thông nghiêm trọng: Xe cứu hộ gây tai nạn liên hoàn tại km146+400 quốc lộ 26 (Đắk Lắk), người đàn ông tử vong do mất lái xe máy ở dốc cầu Bình Lợi (TP Hồ Chí Minh), và xe máy va chạm xe tải chở gỗ khiến cô gái tử vong trên tỉnh lộ 639 (Bình Định).</p><p><strong>Thiệt hại ước tính:</strong> - Vụ quốc lộ 26: 3 phương tiện hư hỏng, không thiệt hại về người. - Vụ cầu Bình Lợi: 1 người đàn ông tử vong, xe máy hư hỏng. - Vụ tỉnh lộ 639: 1 cô gái (SN 2001) tử vong tại chỗ, xe máy hư hỏng.</p><p><strong>Hành động ứng phó:</strong> Công an xã Tuy Phước Đông bảo vệ hiện trường, đảm bảo an toàn giao thông và phối hợp điều tra vụ tỉnh lộ 639. Các vụ khác chưa ghi nhận hành động cụ thể.</p><p><strong>Khuyến cáo:</strong> Không có khuyến cáo được đề cập trong nội dung.</p><a href='https://baomoi.com/tai-nan-giao-thong-moi-nhat-19-10-2025-xe-cuu-ho-gay-tai-nan-lien-hoan-tren-quoc-lo-26-c53531244.epi' target='_blank'>Nguồn gốc</a>"
    },
    {
        title: "Thiên tai đã vượt quá sức chịu đựng của người dân",
        date: "2025-10-10",
        type: "thien-tai",
        location: "thai-nguyen,bac-ninh,cao-bang,lang-son,mien-bac,mien-trung",
        img: "https://premedia.vneconomy.vn/files/uploads/2025/10/10/c999b83a970f40588b4d060116ebed76-20061.png?w=900",
        content: "<p><strong>Tình hình:</strong> Năm 2025, Việt Nam xảy ra 20 loại hình thiên tai với diễn biến dồn dập, khốc liệt, bất thường, vượt mức lịch sử, ảnh hưởng rộng lớn đến miền Bắc và miền Trung. Các cơn bão di chuyển nhanh trên biển nhưng chậm trên đất liền, gây mưa lớn kéo dài; mực nước lũ vượt lịch sử tại nhiều sông (như sông Thương, sông Lô, sông Bưởi); hình thành 'bão chồng bão, lũ chồng lũ' kèm lũ quét, sạt lở đất, ngập lụt nghiêm trọng tại đô thị và vùng trũng thấp.</p><p><strong>Thiệt hại ước tính:</strong> 238 người chết và mất tích, 367 người bị thương; gần 260.000 ngôi nhà hư hỏng, tốc mái; gần 556.000 ha lúa, hoa màu và cây trồng ngập úng; hơn 15.000 con gia súc và 1,45 triệu con gia cầm chết hoặc cuốn trôi; hơn 40.000 ha nuôi trồng thủy sản bị ảnh hưởng. Tổng thiệt hại gần 34 nghìn tỷ đồng (tương đương 47% thiệt hại về người và 37% thiệt hại kinh tế so với năm 2024).</p><p><strong>Hành động ứng phó:</strong> Bộ Nông nghiệp và Môi trường tổ chức họp Đối tác giảm nhẹ rủi ro thiên tai để cập nhật tình hình, đánh giá thiệt hại nhanh và lập kế hoạch tái thiết; thành lập 3 đoàn khảo sát thực địa tại Tuyên Quang - Phú Thọ, Cao Bằng - Lạng Sơn, Bắc Ninh - Thái Nguyên. Chính phủ triển khai biện pháp ứng phó, chính sách hỗ trợ khắc phục; kêu gọi hỗ trợ từ đối tác quốc tế (Liên hợp quốc, UNICEF, WHO, IOM) với cam kết huy động nguồn lực, cung cấp hàng cứu trợ (lương thực, nước uống, nước, thuốc men). Năm 2024, đối tác hỗ trợ 25 triệu USD và hàng nghìn tấn hàng hóa.</p><p><strong>Khuyến cáo:</strong> Đầu tư vào chuẩn bị và ứng phó rủi ro thiên tai, giảm thiểu và xây dựng khả năng phục hồi; hành động tập thể để hỗ trợ khẩn cấp các địa phương bị ảnh hưởng nặng, tập trung khôi phục nhà ở và sản xuất; các tổ chức quốc tế tham gia khảo sát và đánh giá nhu cầu cứu trợ kịp thời.</p><a href='https://vneconomy.vn/thien-tai-da-vuot-qua-suc-chiu-dung-cua-nguoi-dan.htm' target='_blank'>Nguồn gốc</a>"
    }
];

function timeAgo(dateString) {
    const now = new Date();
    const date = new Date(dateString);
    const seconds = Math.floor((now - date) / 1000);
    let interval = Math.floor(seconds / 31536000);
    if (interval > 1) return `${interval} năm trước`;
    interval = Math.floor(seconds / 2592000);
    if (interval > 1) return `${interval} tháng trước`;
    interval = Math.floor(seconds / 86400);
    if (interval > 1) return `${interval} ngày trước`;
    interval = Math.floor(seconds / 3600);
    if (interval > 1) return `${interval} giờ trước`;
    interval = Math.floor(seconds / 60);
    if (interval > 1) return `${interval} phút trước`;
    return "Vừa xong";
}

function renderNews() {
    const grid = document.getElementById('news-grid');
    grid.innerHTML = '';
    const sortedData = newsData.sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 4);
    sortedData.forEach(news => {
        const badgeColor = news.type === 'thien-tai' ? 'bg-blue-600' : news.type === 'tai-nan' ? 'bg-red-600' : news.type === 'cuu-ho' ? 'bg-green-600' : 'bg-yellow-600';
        const badgeText = news.type === 'thien-tai' ? 'Thiên tai' : news.type === 'tai-nan' ? 'Tai nạn' : news.type === 'cuu-ho' ? 'Cứu hộ' : 'Cảnh báo';
        const locBadge = news.location.split(',')[0].replace('-', ' ').toUpperCase();
        const card = document.createElement('div');
        card.className = 'news-card bg-white rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1';
        card.dataset.type = news.type;
        card.dataset.location = news.location;
        card.innerHTML = `
            <div class="relative">
                <img src="${news.img}" alt="${news.title}" class="w-full h-40 object-cover" loading="lazy">
                <span class="absolute top-3 left-3 ${badgeColor} text-white text-xs px-2 py-1 rounded-full font-bold">${badgeText}</span>
                <span class="absolute top-3 right-3 bg-purple-600 text-white text-xs px-2 py-1 rounded-full font-bold">${locBadge}</span>
            </div>
            <div class="p-5">
                <div class="flex items-center text-sm text-gray-500 mb-2">
                    <i data-feather="clock" class="mr-1 w-4 h-4"></i>
                    <span>${timeAgo(news.date)}</span>
                </div>
                <h3 class="text-lg font-bold mb-2">${news.title}</h3>
                <p class="text-gray-600 mb-3 text-sm">${news.content.replace(/<[^>]+>/g, '').substring(0, 80)}...</p>
                <button onclick="openModal(${newsData.indexOf(news)})" class="text-red-600 hover:text-red-800 font-medium flex items-center text-sm">
                    Xem chi tiết
                    <i data-feather="arrow-right" class="ml-1 w-4 h-4"></i>
                </button>
            </div>
        `;
        grid.appendChild(card);
    });
    feather.replace();
}

function showSkeleton() {
    const grid = document.getElementById('news-grid');
    grid.innerHTML = '';
    for (let i = 0; i < 4; i++) {
        const skeletonCard = document.createElement('div');
        skeletonCard.className = 'news-card bg-white rounded-xl overflow-hidden shadow-md';
        skeletonCard.innerHTML = `
            <div class="w-full h-40 skeleton"></div>
            <div class="p-5">
                <div class="h-4 w-24 skeleton mb-2"></div>
                <div class="h-6 w-full skeleton mb-2"></div>
                <div class="h-4 w-3/4 skeleton mb-3"></div>
                <div class="h-4 w-32 skeleton"></div>
            </div>
        `;
        grid.appendChild(skeletonCard);
    }
}

function openModal(index) {
    const news = newsData[index];
    const modal = document.getElementById('news-modal');
    document.getElementById('modal-title').textContent = news.title;
    document.getElementById('modal-content').innerHTML = `<img src="${news.img}" alt="${news.title}" class="w-full h-48 object-cover rounded-md mb-4">${news.content}`;
    document.getElementById('map-link').href = `index.html#map?location=${news.location.split(',')[0]}`;
    const related = document.getElementById('related-news').querySelector('.space-y-2');
    related.innerHTML = '';
    newsData.filter((n, i) => i !== index && n.type === news.type).slice(0, 5).forEach(n => {
        const link = document.createElement('a');
        link.href = '#';
        link.onclick = () => { closeModal(); openModal(newsData.indexOf(n)); return false; };
        link.className = 'block text-sm text-gray-700 hover:text-red-600';
        link.textContent = `→ ${n.title}`;
        related.appendChild(link);
    });
    document.getElementById('share-news').onclick = () => {
        if (navigator.share) {
            navigator.share({
                title: news.title,
                text: news.content.replace(/<[^>]+>/g, '').substring(0, 100) + '...',
                url: window.location.href
            });
        } else {
            alert('Chức năng chia sẻ không được hỗ trợ trên thiết bị này.');
        }
    };
    modal.classList.remove('hidden');
}

function closeModal() {
    document.getElementById('news-modal').classList.add('hidden');
}

document.getElementById('close-modal').addEventListener('click', closeModal);

showSkeleton();
setTimeout(() => {
    renderNews();
}, 500);