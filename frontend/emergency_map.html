<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£n ƒê·ªì C·ª©u H·ªô - H·ªá Th·ªëng C·ª©u H·ªô Qu·ªëc Gia</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap');
        :root {
            --primary: #ef4444;
            --primary-light: #fee2e2;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            scroll-behavior: smooth;
        }
        .nav-link {
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }
        .nav-link:hover::after {
            width: 100%;
        }
        .custom-marker {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        .leaflet-popup-content {
            margin: 8px 12px;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .emergency-card {
            transition: all 0.3s ease;
            border-left: 4px solid;
        }
        .emergency-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .emergency-detail-modal {
            max-height: 90vh;
            overflow-y: auto;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .priority-high {
            background-color: #fee2e2;
            color: #dc2626;
        }
        .priority-medium {
            background-color: #fef3c7;
            color: #d97706;
        }
        .priority-low {
            background-color: #d1fae5;
            color: #059669;
        }
        
        /* FIX: ƒê·∫£m b·∫£o header lu√¥n hi·ªÉn th·ªã tr√™n b·∫£n ƒë·ªì */
        nav {
            z-index: 1000;
            position: relative;
        }
        
        #map {
            position: relative;
            z-index: 1;
        }
        
        /* ƒê·∫£m b·∫£o mobile menu hi·ªÉn th·ªã tr√™n map */
        #mobile-menu {
            z-index: 1001;
            position: relative;
        }
        
        /* ƒê·∫£m b·∫£o modal hi·ªÉn th·ªã tr√™n t·∫•t c·∫£ */
        #emergency-detail-modal {
            z-index: 1002;
        }
        
        /* ƒê·∫£m b·∫£o ph·∫ßn th√¥ng tin sticky kh√¥ng b·ªã che */
        .sticky-panel {
            z-index: 50;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-50 backdrop-blur-sm bg-opacity-80">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                    <span class="text-2xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">C·ª®U H·ªò QU·ªêC GIA</span>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="nav-link text-gray-700 hover:text-red-500 font-medium transition">Trang ch·ªß</a>
                    <a href="map.html" class="nav-link text-red-500 font-medium transition">B·∫£n ƒë·ªì c·ª©u h·ªô</a>
                    <a href="news.html" class="nav-link text-gray-700 hover:text-red-500 font-medium transition">B·∫£n tin</a>
                    <a href="post.html" class="nav-link text-gray-700 hover:text-red-500 font-medium transition">B√°o tin</a>
                    <div class="flex space-x-4">
                        <a href="admin.html" class="bg-gray-800 hover:bg-gray-900 text-white px-4 py-2 rounded-lg font-medium transition-all shadow hover:shadow-lg">Admin</a>
                        <a href="login.html" class="bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-all shadow hover:shadow-lg">ƒêƒÉng nh·∫≠p</a>
                    </div>
                </div>
                <div class="md:hidden flex items-center">
                    <button id="menu-toggle" class="text-gray-700 hover:text-red-600">
                        <i data-feather="menu"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white py-2 px-4 shadow-lg">
            <a href="index.html" class="block py-2 text-gray-700 hover:text-red-600 transition">Trang ch·ªß</a>
            <a href="map.html" class="block py-2 text-red-600 font-medium transition">B·∫£n ƒë·ªì c·ª©u h·ªô</a>
            <a href="news.html" class="block py-2 text-gray-700 hover:text-red-600 transition">B·∫£n tin</a>
            <a href="post.html" class="block py-2 text-gray-700 hover:text-red-600 transition">B√°o tin</a>
            <a href="admin.html" class="block py-2 text-white bg-gray-800 rounded-md text-center">Admin</a>
            <a href="login.html" class="block py-2 text-white bg-red-600 rounded-md text-center mt-2">ƒêƒÉng nh·∫≠p</a>
        </div>
    </nav>

    <!-- Emergency Alert Banner -->
    <div class="bg-gradient-to-r from-red-500 to-orange-500 text-white py-3 px-4 text-center animate-pulse">
        <div class="max-w-7xl mx-auto flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            <span class="font-medium tracking-wide">C·∫¢NH B√ÅO THI√äN TAI: M∆∞a l·ªõn di·ªán r·ªông t·∫°i mi·ªÅn Trung - C·∫≠p nh·∫≠t l√∫c 14:30 15/06/2023</span>
        </div>
    </div>

    <!-- Map Section -->
    <section class="py-8 bg-gradient-to-b from-gray-50 to-white relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Breadcrumb -->
            <div class="mb-6">
                <nav class="flex" aria-label="Breadcrumb">
                    <ol class="flex items-center space-x-2 text-sm">
                        <li>
                            <a href="index.html" class="text-gray-500 hover:text-gray-700">Trang ch·ªß</a>
                        </li>
                        <li class="flex items-center">
                            <i data-feather="chevron-right" class="text-gray-400 w-4 h-4"></i>
                            <span class="ml-2 text-red-600 font-medium">B·∫£n ƒë·ªì c·ª©u h·ªô</span>
                        </li>
                    </ol>
                </nav>
            </div>

            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">
                    B·∫£n ƒê·ªì C·ª©u H·ªô Tr·ª±c Tuy·∫øn
                </h1>
                <p class="text-gray-600 max-w-2xl mx-auto text-lg">
                    Theo d√µi c√°c ƒëi·ªÉm c·ª©u h·ªô, s·ª± c·ªë v√† l·ª±c l∆∞·ª£ng ·ª©ng ph√≥ trong th·ªùi gian th·ª±c tr√™n to√†n qu·ªëc
                </p>
            </div>

            <!-- B·ªô l·ªçc v√† t√¨m ki·∫øm -->
            <div class="mb-6 bg-white rounded-2xl shadow-lg p-6">
                <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between">
                    <!-- T√¨m ki·∫øm -->
                    <div class="flex-1 w-full lg:w-auto">
                        <div class="relative">
                            <i data-feather="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                            <input 
                                type="text" 
                                id="search-incidents" 
                                placeholder="T√¨m ki·∫øm s·ª± c·ªë, ƒë·ªãa ƒëi·ªÉm..." 
                                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition"
                            >
                        </div>
                    </div>

                    <!-- B·ªô l·ªçc t·ªânh th√†nh -->
                    <div class="w-full lg:w-64">
                        <select id="province-filter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                            <option value="all">T·∫•t c·∫£ t·ªânh th√†nh</option>
                            <option value="hanoi">H√† N·ªôi</option>
                            <option value="hcm">TP.H·ªì Ch√≠ Minh</option>
                            <option value="danang">ƒê√† N·∫µng</option>
                            <option value="hue">Th·ª´a Thi√™n Hu·∫ø</option>
                            <option value="nghean">Ngh·ªá An</option>
                            <option value="thanhhoa">Thanh H√≥a</option>
                            <option value="haiphong">H·∫£i Ph√≤ng</option>
                            <option value="cantho">C·∫ßn Th∆°</option>
                        </select>
                    </div>

                    <!-- B·ªô l·ªçc lo·∫°i s·ª± c·ªë -->
                    <div class="w-full lg:w-64">
                        <select id="type-filter" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                            <option value="all">T·∫•t c·∫£ lo·∫°i s·ª± c·ªë</option>
                            <option value="fire">H·ªèa ho·∫°n</option>
                            <option value="flood">Ng·∫≠p l·ª•t</option>
                            <option value="accident">Tai n·∫°n giao th√¥ng</option>
                            <option value="disaster">Thi√™n tai</option>
                            <option value="rescue">C·ª©u h·ªô</option>
                            <option value="warning">C·∫£nh b√°o</option>
                        </select>
                    </div>

                    <!-- N√∫t reset -->
                    <button id="reset-filters" class="px-6 py-3 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-xl transition flex items-center whitespace-nowrap">
                        <i data-feather="refresh-cw" class="mr-2 w-4 h-4"></i> ƒê·∫∑t l·∫°i
                    </button>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row gap-8 relative">
                <!-- üó∫Ô∏è B·∫£n ƒë·ªì -->
                <div class="lg:w-2/3 relative z-10">
                    <div id="map" class="h-[600px] w-full rounded-2xl shadow-xl border border-gray-200 relative"></div>

                    <!-- Controls -->
                    <div class="mt-4 flex flex-wrap gap-3 items-center justify-between">
                        <div class="flex flex-wrap gap-2">
                            <button id="locate-btn" class="bg-white border border-gray-300 px-4 py-2 rounded-lg flex items-center hover:bg-gray-50 transition shadow-sm">
                                <i data-feather="map-pin" class="mr-2 w-4 h-4"></i> V·ªã tr√≠ c·ªßa t√¥i
                            </button>
                            <button id="zoom-in-btn" class="bg-white border border-gray-300 px-4 py-2 rounded-lg flex items-center hover:bg-gray-50 transition shadow-sm">
                                <i data-feather="zoom-in" class="mr-2 w-4 h-4"></i> Ph√≥ng to
                            </button>
                            <button id="zoom-out-btn" class="bg-white border border-gray-300 px-4 py-2 rounded-lg flex items-center hover:bg-gray-50 transition shadow-sm">
                                <i data-feather="zoom-out" class="mr-2 w-4 h-4"></i> Thu nh·ªè
                            </button>
                        </div>
                        
                        <div class="flex items-center text-sm text-gray-600">
                            <div class="flex items-center mr-4">
                                <div class="w-3 h-3 bg-red-500 rounded-full mr-2 animate-pulse"></div>
                                <span>ƒêang x·ª≠ l√Ω</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                <span>ƒê√£ gi·∫£i quy·∫øt</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- üî• Panel th√¥ng tin -->
                <div class="lg:w-1/3 relative z-30">
                    <div class="bg-white rounded-2xl shadow-xl overflow-hidden sticky-panel sticky top-24">
                        <!-- Header -->
                        <div class="bg-gradient-to-r from-red-500 to-orange-500 p-6 text-white">
                            <h3 class="text-xl font-bold mb-2 flex items-center">
                                <i data-feather="activity" class="mr-2 w-5 h-5"></i>
                                Th·ªëng K√™ S·ª± C·ªë
                            </h3>
                            <p class="text-red-100 text-sm">C·∫≠p nh·∫≠t l√∫c: <span id="last-update">--:--:--</span></p>
                        </div>

                        <!-- Th·ªëng k√™ -->
                        <div class="p-6 border-b border-gray-200">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center p-4 bg-red-50 rounded-xl">
                                    <div class="text-2xl font-bold text-red-600" id="active-incidents">0</div>
                                    <div class="text-sm text-red-700 font-medium">ƒêang x·ª≠ l√Ω</div>
                                </div>
                                <div class="text-center p-4 bg-green-50 rounded-xl">
                                    <div class="text-2xl font-bold text-green-600" id="resolved-incidents">0</div>
                                    <div class="text-sm text-green-700 font-medium">ƒê√£ gi·∫£i quy·∫øt</div>
                                </div>
                                <div class="text-center p-4 bg-blue-50 rounded-xl">
                                    <div class="text-2xl font-bold text-blue-600" id="total-incidents">0</div>
                                    <div class="text-sm text-blue-700 font-medium">T·ªïng s·ª± c·ªë</div>
                                </div>
                                <div class="text-center p-4 bg-purple-50 rounded-xl">
                                    <div class="text-2xl font-bold text-purple-600" id="response-time">12'</div>
                                    <div class="text-sm text-purple-700 font-medium">Th·ªùi gian ƒë√°p ·ª©ng</div>
                                </div>
                            </div>
                        </div>

                        <!-- Ch√∫ th√≠ch -->
                        <div class="p-6">
                            <h4 class="font-bold mb-4 text-gray-800 flex items-center">
                                <i data-feather="map" class="text-red-500 mr-2 w-4 h-4"></i>
                                Ch√∫ Th√≠ch B·∫£n ƒê·ªì
                            </h4>

                            <div class="space-y-3">
                                <!-- H·ªèa ho·∫°n -->
                                <div class="flex items-center p-3 bg-red-50 rounded-lg border border-red-200 hover:bg-red-100 transition cursor-pointer" data-type="fire">
                                    <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center mr-3">
                                        <i data-feather="flame" class="text-white w-4 h-4"></i>
                                    </div>
                                    <div class="flex-1">
                                        <span class="font-semibold text-red-700">üî• H·ªèa ho·∫°n</span>
                                        <p class="text-sm text-red-600">Ch√°y nh√†, ch√°y r·ª´ng, n·ªï</p>
                                    </div>
                                    <div class="w-6 h-6 bg-red-500 rounded-full flex items-center justify-center text-white text-xs font-bold" id="count-fire">0</div>
                                </div>

                                <!-- Ng·∫≠p l·ª•t -->
                                <div class="flex items-center p-3 bg-blue-50 rounded-lg border border-blue-200 hover:bg-blue-100 transition cursor-pointer" data-type="flood">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                                        <i data-feather="droplet" class="text-white w-4 h-4"></i>
                                    </div>
                                    <div class="flex-1">
                                        <span class="font-semibold text-blue-700">üíß Ng·∫≠p l·ª•t</span>
                                        <p class="text-sm text-blue-600">Ng·∫≠p n∆∞·ªõc, l≈© qu√©t</p>
                                    </div>
                                    <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold" id="count-flood">0</div>
                                </div>

                                <!-- Tai n·∫°n giao th√¥ng -->
                                <div class="flex items-center p-3 bg-orange-50 rounded-lg border border-orange-200 hover:bg-orange-100 transition cursor-pointer" data-type="accident">
                                    <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center mr-3">
                                        <i data-feather="activity" class="text-white w-4 h-4"></i>
                                    </div>
                                    <div class="flex-1">
                                        <span class="font-semibold text-orange-700">üöó Tai n·∫°n giao th√¥ng</span>
                                        <p class="text-sm text-orange-600">TNGT ƒë∆∞·ªùng b·ªô, ƒë∆∞·ªùng s·∫Øt</p>
                                    </div>
                                    <div class="w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center text-white text-xs font-bold" id="count-accident">0</div>
                                </div>

                                <!-- Thi√™n tai -->
                                <div class="flex items-center p-3 bg-purple-50 rounded-lg border border-purple-200 hover:bg-purple-100 transition cursor-pointer" data-type="disaster">
                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center mr-3">
                                        <i data-feather="alert-octagon" class="text-white w-4 h-4"></i>
                                    </div>
                                    <div class="flex-1">
                                        <span class="font-semibold text-purple-700">üå™Ô∏è Thi√™n tai</span>
                                        <p class="text-sm text-purple-600">B√£o l·ª•t, s·∫°t l·ªü, ƒë·ªông ƒë·∫•t</p>
                                    </div>
                                    <div class="w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center text-white text-xs font-bold" id="count-disaster">0</div>
                                </div>

                                <!-- C·ª©u h·ªô -->
                                <div class="flex items-center p-3 bg-green-50 rounded-lg border border-green-200 hover:bg-green-100 transition cursor-pointer" data-type="rescue">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3">
                                        <i data-feather="users" class="text-white w-4 h-4"></i>
                                    </div>
                                    <div class="flex-1">
                                        <span class="font-semibold text-green-700">üõü C·ª©u h·ªô</span>
                                        <p class="text-sm text-green-600">Ho·∫°t ƒë·ªông c·ª©u h·ªô kh·∫©n c·∫•p</p>
                                    </div>
                                    <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-white text-xs font-bold" id="count-rescue">0</div>
                                </div>

                                <!-- C·∫£nh b√°o -->
                                <div class="flex items-center p-3 bg-yellow-50 rounded-lg border border-yellow-200 hover:bg-yellow-100 transition cursor-pointer" data-type="warning">
                                    <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center mr-3">
                                        <i data-feather="alert-triangle" class="text-white w-4 h-4"></i>
                                    </div>
                                    <div class="flex-1">
                                        <span class="font-semibold text-yellow-700">‚ö†Ô∏è C·∫£nh b√°o</span>
                                        <p class="text-sm text-yellow-600">C·∫£nh b√°o thi√™n tai, th·ªùi ti·∫øt</p>
                                    </div>
                                    <div class="w-6 h-6 bg-yellow-500 rounded-full flex items-center justify-center text-white text-xs font-bold" id="count-warning">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Danh s√°ch s·ª± c·ªë g·∫ßn ƒë√¢y -->
            <div class="mt-12">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold mb-6 flex items-center text-gray-800">
                        <i data-feather="alert-triangle" class="text-red-500 mr-2 w-6 h-6"></i>
                        S·ª± C·ªë G·∫ßn ƒê√¢y
                    </h3>
                    <div id="recent-incidents" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- S·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal Chi Ti·∫øt S·ª± C·ªë -->
    <div id="emergency-detail-modal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity modal-overlay" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>

            <div class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full emergency-detail-modal">
                <div class="bg-white px-6 pt-6 pb-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-2xl font-bold text-gray-900" id="modal-title">Chi Ti·∫øt S·ª± C·ªë</h3>
                        <button id="close-modal" class="text-gray-400 hover:text-gray-600 transition">
                            <i data-feather="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Th√¥ng tin c∆° b·∫£n -->
                        <div class="space-y-4">
                            <div class="bg-gray-50 rounded-xl p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-800 flex items-center">
                                    <i data-feather="info" class="text-blue-500 mr-2 w-5 h-5"></i>
                                    Th√¥ng Tin C∆° B·∫£n
                                </h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">M√£ s·ª± c·ªë:</span>
                                        <span class="font-semibold" id="modal-id">--</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Lo·∫°i s·ª± c·ªë:</span>
                                        <span class="font-semibold" id="modal-type">--</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Tr·∫°ng th√°i:</span>
                                        <span class="status-badge" id="modal-status">--</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">M·ª©c ƒë·ªô ∆∞u ti√™n:</span>
                                        <span class="status-badge" id="modal-priority">--</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Th·ªùi gian b√°o c√°o:</span>
                                        <span class="font-semibold" id="modal-time">--</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Th√¥ng tin ƒë·ªãa ƒëi·ªÉm -->
                            <div class="bg-gray-50 rounded-xl p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-800 flex items-center">
                                    <i data-feather="map-pin" class="text-green-500 mr-2 w-5 h-5"></i>
                                    Th√¥ng Tin ƒê·ªãa ƒêi·ªÉm
                                </h4>
                                <div class="space-y-3">
                                    <div>
                                        <span class="text-gray-600 block mb-1">ƒê·ªãa ch·ªâ:</span>
                                        <span class="font-semibold" id="modal-address">--</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600 block mb-1">T·ªânh/Th√†nh ph·ªë:</span>
                                        <span class="font-semibold" id="modal-province">--</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-600 block mb-1">T·ªça ƒë·ªô:</span>
                                        <span class="font-semibold" id="modal-coords">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Th√¥ng tin chi ti·∫øt -->
                        <div class="space-y-4">
                            <!-- M√¥ t·∫£ s·ª± c·ªë -->
                            <div class="bg-gray-50 rounded-xl p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-800 flex items-center">
                                    <i data-feather="file-text" class="text-purple-500 mr-2 w-5 h-5"></i>
                                    M√¥ T·∫£ S·ª± C·ªë
                                </h4>
                                <p class="text-gray-700" id="modal-description">--</p>
                            </div>

                            <!-- Th√¥ng tin ng∆∞·ªùi b√°o c√°o -->
                            <div class="bg-gray-50 rounded-xl p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-800 flex items-center">
                                    <i data-feather="user" class="text-orange-500 mr-2 w-5 h-5"></i>
                                    Th√¥ng Tin Ng∆∞·ªùi B√°o C√°o
                                </h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">H·ªç t√™n:</span>
                                        <span class="font-semibold" id="modal-reporter-name">--</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">S·ªë ƒëi·ªán tho·∫°i:</span>
                                        <span class="font-semibold" id="modal-reporter-phone">--</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">Th·ªùi gian b√°o c√°o:</span>
                                        <span class="font-semibold" id="modal-report-time">--</span>
                                    </div>
                                </div>
                            </div>

                            <!-- L·ª±c l∆∞·ª£ng ·ª©ng ph√≥ -->
                            <div class="bg-gray-50 rounded-xl p-4">
                                <h4 class="font-semibold text-lg mb-3 text-gray-800 flex items-center">
                                    <i data-feather="users" class="text-red-500 mr-2 w-5 h-5"></i>
                                    L·ª±c L∆∞·ª£ng ·ª®ng Ph√≥
                                </h4>
                                <div class="space-y-2" id="modal-response-teams">
                                    <!-- S·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ti·∫øn tr√¨nh x·ª≠ l√Ω -->
                    <div class="mt-6 bg-gray-50 rounded-xl p-4">
                        <h4 class="font-semibold text-lg mb-3 text-gray-800 flex items-center">
                            <i data-feather="clock" class="text-indigo-500 mr-2 w-5 h-5"></i>
                            Ti·∫øn Tr√¨nh X·ª≠ L√Ω
                        </h4>
                        <div class="space-y-3" id="modal-timeline">
                            <!-- S·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JavaScript -->
                        </div>
                    </div>

                    <!-- N√∫t h√†nh ƒë·ªông -->
                    <div class="mt-6 flex flex-wrap gap-3 justify-end">
                        <button id="modal-close-btn" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                            ƒê√≥ng
                        </button>
                        <button id="modal-share-btn" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition flex items-center">
                            <i data-feather="share-2" class="mr-2 w-4 h-4"></i>
                            Chia s·∫ª
                        </button>
                        <button id="modal-navigate-btn" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition flex items-center">
                            <i data-feather="navigation" class="mr-2 w-4 h-4"></i>
                            Ch·ªâ ƒë∆∞·ªùng
                        </button>
                        <button id="modal-report-btn" class="px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition flex items-center">
                            <i data-feather="alert-triangle" class="mr-2 w-4 h-4"></i>
                            B√°o c√°o sai
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                        </svg>
                        <span class="text-2xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">C·ª®U H·ªò QU·ªêC GIA</span>
                    </div>
                    <p class="text-gray-400 leading-relaxed">K·∫øt n·ªëi ng∆∞·ªùi d√¢n v·ªõi l·ª±c l∆∞·ª£ng c·ª©u h·ªô trong c√°c t√¨nh hu·ªëng kh·∫©n c·∫•p.</p>
                </div>
                <div>
                    <h4 class="font-bold mb-4">D·ªãch V·ª•</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">C·ª©u h·ªèa</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">C·ª©u h·ªô giao th√¥ng</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Y t·∫ø kh·∫©n c·∫•p</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">·ª®ng ph√≥ thi√™n tai</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Li√™n K·∫øt</h4>
                    <ul class="space-y-2">
                        <li><a href="index.html" class="text-gray-400 hover:text-white transition">Trang ch·ªß</a></li>
                        <li><a href="map.html" class="text-gray-400 hover:text-white transition">B·∫£n ƒë·ªì c·ª©u h·ªô</a></li>
                        <li><a href="news.html" class="text-gray-400 hover:text-white transition">B·∫£n tin</a></li>
                        <li><a href="post.html" class="text-gray-400 hover:text-white transition">B√°o tin</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">H·ªó Tr·ª£</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition">ƒêi·ªÅu kho·∫£n d·ªãch v·ª•</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>¬© 2023 H·ªá Th·ªëng C·ª©u H·ªô Qu·ªëc Gia. B·∫£n quy·ªÅn thu·ªôc v·ªÅ B·ªô C√¥ng An.</p>
            </div>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Kh·ªüi t·∫°o Feather Icons
        feather.replace();

        // Mobile menu toggle
        document.getElementById('menu-toggle').addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
            
            const isHidden = menu.classList.contains('hidden');
            this.innerHTML = isHidden ? feather.icons.menu.toSvg() : feather.icons.x.toSvg();
        });

        // üîπ D·ªØ li·ªáu tin t·ª©c t·ª´ trang news (ƒë·ªìng b·ªô)
        const newsData = [
            {
                title: "ƒê√† N·∫µng: Ch·ªß ƒë·ªông ·ª©ng ph√≥ thi√™n tai nh·ªØng th√°ng cu·ªëi nƒÉm",
                date: "2025-10-21",
                type: "thien-tai",
                location: "da-nang,mien-trung",
                img: "https://media.daidoanket.vn/w1280/uploaded/images/2025/10/18/8898fcf6-b66a-433c-908c-72eb18bbdeb1.jpg",
                content: "<p><strong>T√¨nh h√¨nh:</strong> TP. ƒê√† N·∫µng ƒëang h·ª©ng ch·ªãu th·ªùi ti·∫øt c·ª±c ƒëoan, m∆∞a l·ªõn k√©o d√†i g√¢y s·∫°t l·ªü nghi√™m tr·ªçng t·∫°i nhi·ªÅu khu v·ª±c. ƒê√°ng ch√∫ √Ω, b·ªù bi·ªÉn ph∆∞·ªùng H·ªôi An T√¢y b·ªã s√≥ng ƒë√°nh m·∫°nh, s·∫°t l·ªü d√†i h∆°n 200m v·ªõi v√°ch ƒë·ª©ng cao 5-6m, c√¢y ch·∫Øn s√≥ng b·∫≠t g·ªëc, c√¥ng tr√¨nh ven bi·ªÉn nguy c∆° s·ª•p ƒë·ªï.</p>"
            },
            {
                title: "Tai n·∫°n giao th√¥ng m·ªõi nh·∫•t 19/10/2025: xe c·ª©u h·ªô g√¢y tai n·∫°n li√™n ho√†n tr√™n qu·ªëc l·ªô 26",
                date: "2025-10-19",
                type: "tai-nan",
                location: "dak-lak,tp-hcm,binh-dinh,tay-nguyen",
                img: "https://cdnphoto.dantri.com.vn/fT-JEopnjSnsEkgTdgpPSX-an_8=/thumb_w/1020/2025/10/19/z7132063905158f9b65fad4a12b3160200c0a32ca66181-edited-1760843872053.jpg",
                content: "<p><strong>T√¨nh h√¨nh:</strong> Ng√†y 19/10/2025, x·∫£y ra ba v·ª• tai n·∫°n giao th√¥ng nghi√™m tr·ªçng: Xe c·ª©u h·ªô g√¢y tai n·∫°n li√™n ho√†n t·∫°i km146+400 qu·ªëc l·ªô 26 (ƒê·∫Øk L·∫Øk), ng∆∞·ªùi ƒë√†n √¥ng t·ª≠ vong do m·∫•t l√°i xe m√°y ·ªü d·ªëc c·∫ßu B√¨nh L·ª£i (TP H·ªì Ch√≠ Minh), v√† xe m√°y va ch·∫°m xe t·∫£i ch·ªü g·ªó khi·∫øn c√¥ g√°i t·ª≠ vong tr√™n t·ªânh l·ªô 639 (B√¨nh ƒê·ªãnh).</p>"
            },
            {
                title: "Thi√™n tai ƒë√£ v∆∞·ª£t qu√° s·ª©c ch·ªãu ƒë·ª±ng c·ªßa ng∆∞·ªùi d√¢n",
                date: "2025-10-10",
                type: "thien-tai",
                location: "thai-nguyen,bac-ninh,cao-bang,lang-son,mien-bac,mien-trung",
                img: "https://premedia.vneconomy.vn/files/uploads/2025/10/10/c999b83a970f40588b4d060116ebed76-20061.png?w=900",
                content: "<p><strong>T√¨nh h√¨nh:</strong> NƒÉm 2025, Vi·ªát Nam x·∫£y ra 20 lo·∫°i h√¨nh thi√™n tai v·ªõi di·ªÖn bi·∫øn d·ªìn d·∫≠p, kh·ªëc li·ªát, b·∫•t th∆∞·ªùng, v∆∞·ª£t m·ª©c l·ªãch s·ª≠, ·∫£nh h∆∞·ªüng r·ªông l·ªõn ƒë·∫øn mi·ªÅn B·∫Øc v√† mi·ªÅn Trung.</p>"
            },
            {
                title: "Vi·ªát Nam k√™u g·ªçi qu·ªëc t·∫ø h·ªó tr·ª£ kh·∫Øc ph·ª•c h·∫≠u qu·∫£ thi√™n tai",
                date: "2025-10-09",
                type: "cuu-ho",
                location: "ha-noi,mien-bac,mien-trung",
                img: "https://image.phunuonline.com.vn/fckeditor/upload/2025/20251009/images/lien-hop-quoc-keu-goi-ho-_241760006840.jpg",
                content: "<p><strong>T√¨nh h√¨nh:</strong> Trong hai th√°ng 9 v√† 10/2025, Vi·ªát Nam li√™n ti·∫øp h·ª©ng ch·ªãu b√£o s·ªë 8, 9, 10 v√† 11 c√πng m∆∞a l≈© l·ªõn. B√£o s·ªë 10 ƒë·ªï b·ªô v√†o Ngh·ªá An - H√† Tƒ©nh ƒë√™m 28 v√† r·∫°ng s√°ng 29/9 v·ªõi t·ªëc ƒë·ªô nhanh, c∆∞·ªùng ƒë·ªô m·∫°nh, ph·∫°m vi r·ªông.</p>"
            },
            {
                title: "L·ª±c l∆∞·ª£ng C√¥ng an nh√¢n d√¢n ch·ªß ƒë·ªông ·ª©ng ph√≥ v·ªõi b√£o s·ªë 12 v√† nguy c∆° m∆∞a l·ªõn",
                date: "2025-10-20",
                type: "canh-bao",
                location: "mien-trung,mien-bac",
                img: "https://dbnd.1cdn.vn/2025/10/20/dbqgxtnd202510201700-17609581259941101885533.jpg",
                content: "<p><strong>T√¨nh h√¨nh:</strong> B√£o s·ªë 12 (Fengshen) ƒëi v√†o Bi·ªÉn ƒê√¥ng chi·ªÅu 19/10/2025, s·ª©c gi√≥ c·∫•p 9 gi·∫≠t c·∫•p 11, di chuy·ªÉn h∆∞·ªõng T√¢y B·∫Øc 25km/h.</p>"
            }
        ];

        // üîπ H√†m chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu t·ª´ news sang emergencies
        function convertNewsToEmergencies(newsData) {
            const typeMapping = {
                'thien-tai': 'disaster',
                'tai-nan': 'accident', 
                'cuu-ho': 'rescue',
                'canh-bao': 'warning'
            };

            const locationMapping = {
                'ha-noi': [21.0278, 105.8342],
                'tp-hcm': [10.8231, 106.6297],
                'da-nang': [16.0544, 108.2022],
                'mien-bac': [21.5, 105.5],
                'mien-trung': [16.0, 108.0],
                'tay-nguyen': [12.0, 108.0],
                'dak-lak': [12.6667, 108.05],
                'binh-dinh': [14.1667, 109.0],
                'thai-nguyen': [21.6, 105.85],
                'toan-quoc': [16.0, 108.0]
            };

            return newsData.map((news, index) => {
                const primaryLocation = news.location.split(',')[0];
                const coords = locationMapping[primaryLocation] || [16.0, 108.0];
                
                // T·∫°o m√¥ t·∫£ ng·∫Øn t·ª´ content
                const shortDescription = news.content.replace(/<[^>]+>/g, '').substring(0, 150) + '...';
                
                return {
                    id: 1000 + index, // ID b·∫Øt ƒë·∫ßu t·ª´ 1000 ƒë·ªÉ ph√¢n bi·ªát
                    name: news.title,
                    address: getAddressFromNews(news),
                    coords: coords,
                    type: typeMapping[news.type] || 'disaster',
                    province: primaryLocation,
                    status: 'active',
                    time: timeAgo(news.date),
                    description: shortDescription,
                    priority: getPriorityFromNews(news),
                    reporter: {
                        name: 'H·ªá th·ªëng',
                        phone: 'N/A',
                        reportTime: formatDate(news.date)
                    },
                    responseTeams: [
                        { name: "L·ª±c l∆∞·ª£ng c·ª©u h·ªô ƒë·ªãa ph∆∞∆°ng", status: "S·∫µn s√†ng", eta: "ƒêang ƒëi·ªÅu ph·ªëi" }
                    ],
                    timeline: [
                        { time: formatTime(news.date), event: "Ti·∫øp nh·∫≠n b√°o c√°o tin t·ª©c", status: "completed" },
                        { time: "ƒêang c·∫≠p nh·∫≠t", event: "ƒêi·ªÅu ph·ªëi l·ª±c l∆∞·ª£ng ·ª©ng ph√≥", status: "in-progress" }
                    ],
                    newsData: news // Gi·ªØ nguy√™n d·ªØ li·ªáu g·ªëc ƒë·ªÉ s·ª≠ d·ª•ng sau
                };
            });
        }

        // üîπ H√†m h·ªó tr·ª£ chuy·ªÉn ƒë·ªïi
        function getAddressFromNews(news) {
            const locationNames = {
                'ha-noi': 'H√† N·ªôi',
                'tp-hcm': 'Th√†nh ph·ªë H·ªì Ch√≠ Minh', 
                'da-nang': 'ƒê√† N·∫µng',
                'mien-bac': 'Mi·ªÅn B·∫Øc',
                'mien-trung': 'Mi·ªÅn Trung',
                'tay-nguyen': 'T√¢y Nguy√™n',
                'dak-lak': 'ƒê·∫Øk L·∫Øk',
                'binh-dinh': 'B√¨nh ƒê·ªãnh',
                'thai-nguyen': 'Th√°i Nguy√™n',
                'toan-quoc': 'To√†n qu·ªëc'
            };
            
            const primaryLocation = news.location.split(',')[0];
            return locationNames[primaryLocation] || 'Vi·ªát Nam';
        }

        function getPriorityFromNews(news) {
            const priorityMap = {
                'thien-tai': 'high',
                'tai-nan': 'medium',
                'cuu-ho': 'medium', 
                'canh-bao': 'high'
            };
            return priorityMap[news.type] || 'medium';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN') + ' ' + date.toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'});
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'});
        }

        // üîπ H√†m timeAgo (ƒë·ªìng b·ªô v·ªõi news.html)
        function timeAgo(dateString) {
            const now = new Date();
            const date = new Date(dateString);
            const seconds = Math.floor((now - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval > 1) return `${interval} nƒÉm tr∆∞·ªõc`;
            interval = Math.floor(seconds / 2592000);
            if (interval > 1) return `${interval} th√°ng tr∆∞·ªõc`;
            interval = Math.floor(seconds / 86400);
            if (interval > 1) return `${interval} ng√†y tr∆∞·ªõc`;
            interval = Math.floor(seconds / 3600);
            if (interval > 1) return `${interval} gi·ªù tr∆∞·ªõc`;
            interval = Math.floor(seconds / 60);
            if (interval > 1) return `${interval} ph√∫t tr∆∞·ªõc`;
            return "V·ª´a xong";
        }

        // üîπ T·ªça ƒë·ªô trung t√¢m c√°c t·ªânh th√†nh
        const provinceCoordinates = {
            'hanoi': [21.0278, 105.8342],
            'hcm': [10.8231, 106.6297],
            'danang': [16.0544, 108.2022],
            'hue': [16.4637, 107.5909],
            'nghean': [18.6796, 105.6813],
            'thanhhoa': [19.8076, 105.7766],
            'haiphong': [20.8449, 106.6881],
            'cantho': [10.0452, 105.7469],
            'sonla': [21.3257, 103.9160],
            'ninhbinh': [20.2506, 105.9745]
        };

        // üîπ D·ªØ li·ªáu s·ª± c·ªë m·∫´u v·ªõi th√¥ng tin chi ti·∫øt
        const emergencies = [
            { 
                id: 1, 
                name: "Ch√°y nh√† d√¢n", 
                address: "S·ªë 35 Tr·∫ßn H∆∞ng ƒê·∫°o, Ho√†n Ki·∫øm, H√† N·ªôi", 
                coords: [21.027, 105.85], 
                type: "fire", 
                province: "hanoi", 
                status: "active", 
                time: "10 ph√∫t tr∆∞·ªõc", 
                description: "Ch√°y b√πng ph√°t t·∫°i t√≤a nh√† 5 t·∫ßng, ƒëang c√≥ ng∆∞·ªùi m·∫Øc k·∫πt b√™n trong. L·ª≠a b·∫Øt ƒë·∫ßu t·ª´ t·∫ßng 2 v√† ƒëang lan nhanh l√™n c√°c t·∫ßng tr√™n.",
                priority: "high",
                reporter: {
                    name: "Nguy·ªÖn VƒÉn A",
                    phone: "0912345678",
                    reportTime: "14:20 15/06/2023"
                },
                responseTeams: [
                    { name: "ƒê·ªôi PCCC Qu·∫≠n Ho√†n Ki·∫øm", status: "ƒêang di chuy·ªÉn", eta: "5 ph√∫t" },
                    { name: "Xe c·ª©u th∆∞∆°ng B·ªánh vi·ªán B·∫°ch Mai", status: "S·∫µn s√†ng", eta: "8 ph√∫t" }
                ],
                timeline: [
                    { time: "14:20", event: "Ti·∫øp nh·∫≠n b√°o c√°o s·ª± c·ªë", status: "completed" },
                    { time: "14:22", event: "ƒêi·ªÅu ph·ªëi l·ª±c l∆∞·ª£ng ·ª©ng ph√≥", status: "completed" },
                    { time: "14:25", event: "L·ª±c l∆∞·ª£ng ƒë·∫ßu ti√™n ƒë·∫øn hi·ªán tr∆∞·ªùng", status: "in-progress" }
                ]
            },
            { 
                id: 2, 
                name: "Ng·∫≠p l·ª•t khu d√¢n c∆∞", 
                address: "Khu v·ª±c ƒê·ªãnh C√¥ng, Ho√†ng Mai, H√† N·ªôi", 
                coords: [20.98, 105.84], 
                type: "flood", 
                province: "hanoi", 
                status: "active", 
                time: "25 ph√∫t tr∆∞·ªõc", 
                description: "Ng·∫≠p s√¢u 0.5-0.7m do m∆∞a l·ªõn k√©o d√†i k·∫øt h·ª£p v·ªõi tri·ªÅu c∆∞·ªùng. Nhi·ªÅu ph∆∞∆°ng ti·ªán b·ªã ch·∫øt m√°y, ng∆∞·ªùi d√¢n kh√¥ng th·ªÉ di chuy·ªÉn.",
                priority: "medium",
                reporter: {
                    name: "Tr·∫ßn Th·ªã B",
                    phone: "0923456789",
                    reportTime: "14:05 15/06/2023"
                },
                responseTeams: [
                    { name: "ƒê·ªôi c·ª©u h·ªô Qu·∫≠n Ho√†ng Mai", status: "C√≥ m·∫∑t t·∫°i hi·ªán tr∆∞·ªùng", eta: "0 ph√∫t" }
                ],
                timeline: [
                    { time: "14:05", event: "Ti·∫øp nh·∫≠n b√°o c√°o s·ª± c·ªë", status: "completed" },
                    { time: "14:10", event: "ƒêi·ªÅu ph·ªëi l·ª±c l∆∞·ª£ng ·ª©ng ph√≥", status: "completed" },
                    { time: "14:20", event: "L·ª±c l∆∞·ª£ng ƒë·∫ßu ti√™n ƒë·∫øn hi·ªán tr∆∞·ªùng", status: "completed" }
                ]
            }
        ];

        // üîπ Kh·ªüi t·∫°o d·ªØ li·ªáu t·ª´ news
        const newsEmergencies = convertNewsToEmergencies(newsData);

        // üó∫Ô∏è Kh·ªüi t·∫°o b·∫£n ƒë·ªì
        const map = L.map("map").setView([16.0471, 108.2068], 6);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>'
        }).addTo(map);

        let currentMarkers = [];
        let currentFilters = { type: 'all', province: 'all', search: '' };

        // üîπ H√†m hi·ªÉn th·ªã modal chi ti·∫øt
        function showEmergencyDetail(id) {
            let emergency;
            
            // T√¨m trong emergencies g·ªëc
            emergency = emergencies.find(e => e.id === id);
            
            // N·∫øu kh√¥ng t√¨m th·∫•y, t√¨m trong emergencies t·ª´ news
            if (!emergency) {
                emergency = newsEmergencies.find(e => e.id === id);
            }
            
            if (!emergency) return;

            // C·∫≠p nh·∫≠t modal
            document.getElementById('modal-id').textContent = `#${emergency.id}`;
            document.getElementById('modal-title').textContent = emergency.name;
            document.getElementById('modal-type').textContent = getTypeName(emergency.type);
            document.getElementById('modal-status').textContent = emergency.status === 'active' ? 'ƒêang x·ª≠ l√Ω' : 'ƒê√£ gi·∫£i quy·∫øt';
            document.getElementById('modal-status').className = `status-badge ${emergency.status === 'active' ? 'priority-high' : 'priority-low'}`;
            document.getElementById('modal-priority').textContent = getPriorityName(emergency.priority);
            document.getElementById('modal-priority').className = `status-badge priority-${emergency.priority}`;
            document.getElementById('modal-time').textContent = emergency.time;
            document.getElementById('modal-address').textContent = emergency.address;
            document.getElementById('modal-province').textContent = getProvinceName(emergency.province);
            document.getElementById('modal-coords').textContent = `${emergency.coords[0].toFixed(4)}, ${emergency.coords[1].toFixed(4)}`;
            document.getElementById('modal-description').textContent = emergency.description;
            document.getElementById('modal-reporter-name').textContent = emergency.reporter.name;
            document.getElementById('modal-reporter-phone').textContent = emergency.reporter.phone;
            document.getElementById('modal-report-time').textContent = emergency.reporter.reportTime;

            // Th√™m ngu·ªìn tin n·∫øu l√† t·ª´ news
            if (emergency.newsData) {
                const descriptionEl = document.getElementById('modal-description');
                const cleanContent = emergency.newsData.content.replace(/<[^>]+>/g, '');
                descriptionEl.innerHTML = emergency.description + `<br><br><strong>Ngu·ªìn tin:</strong> ${cleanContent.substring(0, 300)}...`;
            }

            // C·∫≠p nh·∫≠t l·ª±c l∆∞·ª£ng ·ª©ng ph√≥
            const responseTeamsContainer = document.getElementById('modal-response-teams');
            responseTeamsContainer.innerHTML = emergency.responseTeams.map(team => `
                <div class="flex justify-between items-center p-2 bg-white rounded border">
                    <div>
                        <div class="font-medium">${team.name}</div>
                        <div class="text-sm text-gray-600">${team.status}</div>
                    </div>
                    <div class="text-sm font-semibold ${team.eta === '0 ph√∫t' || team.eta === 'ƒêang ƒëi·ªÅu ph·ªëi' ? 'text-orange-600' : 'text-green-600'}">
                        ${team.eta}
                    </div>
                </div>
            `).join('');

            // C·∫≠p nh·∫≠t timeline
            const timelineContainer = document.getElementById('modal-timeline');
            timelineContainer.innerHTML = emergency.timeline.map(item => `
                <div class="flex items-center space-x-3">
                    <div class="flex-shrink-0 w-3 h-3 rounded-full ${
                        item.status === 'completed' ? 'bg-green-500' :
                        item.status === 'in-progress' ? 'bg-yellow-500 animate-pulse' : 'bg-gray-300'
                    }"></div>
                    <div class="flex-1">
                        <div class="flex justify-between">
                            <span class="font-medium">${item.event}</span>
                            <span class="text-sm text-gray-500">${item.time}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            // Hi·ªÉn th·ªã modal
            document.getElementById('emergency-detail-modal').classList.remove('hidden');
            feather.replace();
        }

        // üîπ H√†m ƒë√≥ng modal
        function closeEmergencyDetail() {
            document.getElementById('emergency-detail-modal').classList.add('hidden');
        }

        // üîπ Event listeners cho modal
        document.getElementById('close-modal').addEventListener('click', closeEmergencyDetail);
        document.getElementById('modal-close-btn').addEventListener('click', closeEmergencyDetail);
        document.getElementById('modal-share-btn').addEventListener('click', () => {
            const emergencyId = document.getElementById('modal-id').textContent;
            shareEmergency(parseInt(emergencyId.replace('#', '')));
        });
        document.getElementById('modal-navigate-btn').addEventListener('click', () => {
            const emergencyId = document.getElementById('modal-id').textContent;
            viewEmergencyOnMap(parseInt(emergencyId.replace('#', '')));
            closeEmergencyDetail();
        });
        document.getElementById('modal-report-btn').addEventListener('click', () => {
            alert('C·∫£m ∆°n b·∫°n ƒë√£ b√°o c√°o. Ch√∫ng t√¥i s·∫Ω ki·ªÉm tra th√¥ng tin n√†y.');
        });

        // ƒê√≥ng modal khi click b√™n ngo√†i
        document.getElementById('emergency-detail-modal').addEventListener('click', (e) => {
            if (e.target.id === 'emergency-detail-modal') {
                closeEmergencyDetail();
            }
        });

        // üîπ H√†m c·∫≠p nh·∫≠t th·ªëng k√™
        function updateStatistics() {
            const allEmergencies = [...emergencies, ...newsEmergencies];
            const active = allEmergencies.filter(e => e.status === 'active').length;
            const resolved = allEmergencies.filter(e => e.status === 'resolved').length;
            const total = allEmergencies.length;
            
            document.getElementById('active-incidents').textContent = active;
            document.getElementById('resolved-incidents').textContent = resolved;
            document.getElementById('total-incidents').textContent = total;
            
            // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng theo lo·∫°i
            const typeCounts = {
                fire: 0, flood: 0, accident: 0, disaster: 0, rescue: 0, warning: 0
            };
            
            allEmergencies.forEach(emg => {
                if (typeCounts.hasOwnProperty(emg.type)) {
                    typeCounts[emg.type]++;
                }
            });
            
            Object.keys(typeCounts).forEach(type => {
                const element = document.getElementById(`count-${type}`);
                if (element) {
                    element.textContent = typeCounts[type];
                }
            });

            // C·∫≠p nh·∫≠t th·ªùi gian
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString('vi-VN');
        }

        // üîπ H√†m c·∫≠p nh·∫≠t danh s√°ch s·ª± c·ªë g·∫ßn ƒë√¢y
        function updateRecentIncidents() {
            const container = document.getElementById('recent-incidents');
            
            // K·∫øt h·ª£p emergencies g·ªëc v√† emergencies t·ª´ news (l·∫•y 6 m·ª•c m·ªõi nh·∫•t)
            const allEmergencies = [...emergencies, ...newsEmergencies]
                .sort((a, b) => {
                    // S·∫Øp x·∫øp theo th·ªùi gian (m·ªõi nh·∫•t tr∆∞·ªõc)
                    const timeA = a.newsData ? new Date(a.newsData.date) : new Date();
                    const timeB = b.newsData ? new Date(b.newsData.date) : new Date();
                    return timeB - timeA;
                })
                .slice(0, 6); // Ch·ªâ hi·ªÉn th·ªã 6 m·ª•c m·ªõi nh·∫•t
            
            container.innerHTML = allEmergencies.map(emg => {
                const isFromNews = emg.id >= 1000;
                const typeClass = getTypeClass(emg.type);
                const icon = getIconByType(emg.type);
                
                return `
                    <div class="emergency-card bg-white p-4 rounded-lg border-l-4 ${typeClass.border} hover:shadow-md transition-all cursor-pointer" 
                         onclick="showEmergencyDetail(${emg.id})">
                        <div class="flex items-start justify-between mb-2">
                            <div class="flex items-center">
                                <h4 class="font-bold text-gray-800 mr-2">${emg.name}</h4>
                                ${isFromNews ? '<span class="bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded">TIN T·ª®C</span>' : ''}
                            </div>
                            <span class="px-2 py-1 text-xs rounded ${
                                emg.status === 'active' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'
                            }">
                                ${emg.status === 'active' ? 'ƒêang x·ª≠ l√Ω' : 'ƒê√£ gi·∫£i quy·∫øt'}
                            </span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600 mb-2">
                            <span class="mr-3">${icon}</span>
                            <span>${emg.address}</span>
                        </div>
                        <p class="text-sm text-gray-500 mb-3 line-clamp-2">${emg.description}</p>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-gray-500">${emg.time}</span>
                            <button class="text-blue-600 hover:text-blue-800 font-medium flex items-center">
                                Chi ti·∫øt
                                <i data-feather="arrow-right" class="ml-1 w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            // C·∫≠p nh·∫≠t icons
            feather.replace();
        }

        // üîπ H√†m l·ªçc s·ª± c·ªë
        function filterEmergencies() {
            const allEmergencies = [...emergencies, ...newsEmergencies];
            return allEmergencies.filter(emg => {
                const typeMatch = currentFilters.type === 'all' || emg.type === currentFilters.type;
                const provinceMatch = currentFilters.province === 'all' || emg.province === currentFilters.province;
                const searchMatch = currentFilters.search === '' || 
                    emg.name.toLowerCase().includes(currentFilters.search.toLowerCase()) ||
                    emg.address.toLowerCase().includes(currentFilters.search.toLowerCase());
                
                return typeMatch && provinceMatch && searchMatch;
            });
        }

        // üîπ H√†m chuy·ªÉn ƒë·∫øn t·ªânh th√†nh
        function flyToProvince(provinceCode) {
            if (provinceCode === 'all') {
                map.flyTo([16.0471, 108.2068], 6, {
                    duration: 1.5,
                    easeLinearity: 0.25
                });
            } else if (provinceCoordinates[provinceCode]) {
                const coords = provinceCoordinates[provinceCode];
                map.flyTo(coords, 11, {
                    duration: 1.5,
                    easeLinearity: 0.25
                });
                
                const provinceMarker = L.marker(coords)
                    .addTo(map)
                    .bindPopup(`<b>${getProvinceName(provinceCode)}</b><br>ƒêang hi·ªÉn th·ªã s·ª± c·ªë trong khu v·ª±c`)
                    .openPopup();
                
                setTimeout(() => {
                    map.removeLayer(provinceMarker);
                }, 3000);
            }
        }

        // üîπ H√†m v·∫Ω marker
        function drawMarkers() {
            currentMarkers.forEach(marker => map.removeLayer(marker));
            currentMarkers = [];

            const filteredEmergencies = filterEmergencies();
            
            filteredEmergencies.forEach(emg => {
                const color = getColorByType(emg.type);
                const icon = getIconByType(emg.type);
                
                const marker = L.marker(emg.coords, {
                    icon: L.divIcon({
                        html: `
                            <div class="relative">
                                <div class="w-10 h-10 bg-${color}-500 rounded-full flex items-center justify-center text-white shadow-lg border-2 border-white transform hover:scale-110 transition-transform cursor-pointer ${emg.status === 'resolved' ? 'opacity-70' : ''}">
                                    <span class="text-lg">${icon}</span>
                                </div>
                                ${emg.status === 'active' ? '<div class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>' : ''}
                            </div>
                        `,
                        className: 'custom-marker',
                        iconSize: [40, 40],
                        iconAnchor: [20, 20]
                    })
                })
                .addTo(map)
                .bindPopup(`
                    <div class="p-3 min-w-[250px]">
                        <div class="flex items-center mb-2">
                            <div class="w-6 h-6 bg-${color}-500 rounded-full flex items-center justify-center mr-2 text-white">
                                <span>${icon}</span>
                            </div>
                            <h4 class="font-bold text-gray-800">${emg.name}</h4>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">${emg.address}</p>
                        <p class="text-sm text-gray-500 mb-3 line-clamp-2">${emg.description}</p>
                        <div class="flex justify-between items-center text-xs mb-3">
                            <span class="px-2 py-1 bg-${color}-100 text-${color}-700 rounded">${getTypeName(emg.type)}</span>
                            <span class="text-gray-500">${emg.time}</span>
                        </div>
                        <div class="mt-3 flex gap-2">
                            <button onclick="showEmergencyDetail(${emg.id})" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition">
                                Chi ti·∫øt
                            </button>
                            <button onclick="shareEmergency(${emg.id})" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition">
                                Chia s·∫ª
                            </button>
                        </div>
                    </div>
                `);

                currentMarkers.push(marker);
            });

            updateStatistics();
            updateRecentIncidents();
        }

        // üîπ H√†m h·ªó tr·ª£
        function getColorByType(type) {
            const colors = {
                fire: 'red', flood: 'blue', accident: 'orange', 
                disaster: 'purple', rescue: 'green', warning: 'yellow'
            };
            return colors[type] || 'gray';
        }

        function getIconByType(type) {
            const icons = {
                fire: 'üî•', flood: 'üíß', accident: 'üöó', 
                disaster: 'üå™Ô∏è', rescue: 'üõü', warning: '‚ö†Ô∏è'
            };
            return icons[type] || '‚ö†Ô∏è';
        }

        function getTypeClass(type) {
            const classes = {
                'fire': { border: 'border-red-500', bg: 'bg-red-500' },
                'flood': { border: 'border-blue-500', bg: 'bg-blue-500' },
                'accident': { border: 'border-orange-500', bg: 'bg-orange-500' },
                'disaster': { border: 'border-purple-500', bg: 'bg-purple-500' },
                'rescue': { border: 'border-green-500', bg: 'bg-green-500' },
                'warning': { border: 'border-yellow-500', bg: 'bg-yellow-500' }
            };
            return classes[type] || { border: 'border-gray-500', bg: 'bg-gray-500' };
        }

        function getTypeName(type) {
            const names = {
                fire: 'H·ªèa ho·∫°n', 
                flood: 'Ng·∫≠p l·ª•t', 
                accident: 'Tai n·∫°n', 
                disaster: 'Thi√™n tai',
                rescue: 'C·ª©u h·ªô',
                warning: 'C·∫£nh b√°o'
            };
            return names[type] || 'Kh√°c';
        }

        function getPriorityName(priority) {
            const names = {
                high: 'Cao',
                medium: 'Trung b√¨nh',
                low: 'Th·∫•p'
            };
            return names[priority] || priority;
        }

        function getProvinceName(code) {
            const names = {
                'hanoi': 'H√† N·ªôi',
                'hcm': 'TP. H·ªì Ch√≠ Minh',
                'danang': 'ƒê√† N·∫µng',
                'hue': 'Th·ª´a Thi√™n Hu·∫ø',
                'nghean': 'Ngh·ªá An',
                'thanhhoa': 'Thanh H√≥a',
                'haiphong': 'H·∫£i Ph√≤ng',
                'cantho': 'C·∫ßn Th∆°',
                'sonla': 'S∆°n La',
                'ninhbinh': 'Ninh B√¨nh'
            };
            return names[code] || code;
        }

        // üîπ Event Listeners
        document.getElementById('type-filter').addEventListener('change', (e) => {
            currentFilters.type = e.target.value;
            drawMarkers();
        });

        document.getElementById('province-filter').addEventListener('change', (e) => {
            currentFilters.province = e.target.value;
            flyToProvince(e.target.value);
            drawMarkers();
        });

        document.getElementById('search-incidents').addEventListener('input', (e) => {
            currentFilters.search = e.target.value;
            drawMarkers();
        });

        document.getElementById('reset-filters').addEventListener('click', () => {
            currentFilters = { type: 'all', province: 'all', search: '' };
            document.getElementById('type-filter').value = 'all';
            document.getElementById('province-filter').value = 'all';
            document.getElementById('search-incidents').value = '';
            flyToProvince('all');
            drawMarkers();
        });

        // Click v√†o ch√∫ th√≠ch ƒë·ªÉ l·ªçc
        document.querySelectorAll('[data-type]').forEach(item => {
            item.addEventListener('click', () => {
                currentFilters.type = item.dataset.type;
                document.getElementById('type-filter').value = currentFilters.type;
                drawMarkers();
            });
        });

        // Map controls
        document.getElementById('locate-btn').addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const lat = pos.coords.latitude;
                    const lng = pos.coords.longitude;
                    map.flyTo([lat, lng], 13, {
                        duration: 1.5
                    });
                    L.marker([lat, lng]).addTo(map)
                        .bindPopup("üìç V·ªã tr√≠ c·ªßa b·∫°n")
                        .openPopup();
                }, () => {
                    alert("Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠ c·ªßa b·∫°n. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p v·ªã tr√≠.");
                });
            } else {
                alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã!");
            }
        });

        document.getElementById('zoom-in-btn').addEventListener('click', () => {
            map.zoomIn();
        });

        document.getElementById('zoom-out-btn').addEventListener('click', () => {
            map.zoomOut();
        });

        // üîπ Kh·ªüi t·∫°o
        function initializeMap() {
            drawMarkers();
            updateStatistics();
            updateRecentIncidents();
        }

        initializeMap();

        // C·∫≠p nh·∫≠t th·ªùi gian th·ª±c m·ªói 30 gi√¢y
        setInterval(updateStatistics, 30000);
    </script>

    <!-- H√†m to√†n c·ª•c ƒë·ªÉ s·ª≠ d·ª•ng trong popup -->
    <script>
        function shareEmergency(id) {
            let emergency;
            emergency = emergencies.find(e => e.id === id);
            if (!emergency) {
                emergency = newsEmergencies.find(e => e.id === id);
            }
            
            if (emergency && navigator.share) {
                navigator.share({
                    title: `S·ª± c·ªë: ${emergency.name}`,
                    text: `${emergency.name} - ${emergency.address}\n${emergency.description}`,
                    url: window.location.href
                });
            } else {
                alert('Ch·ª©c nƒÉng chia s·∫ª kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£ tr√™n thi·∫øt b·ªã n√†y.');
            }
        }

        function viewEmergencyOnMap(id) {
            let emergency;
            emergency = emergencies.find(e => e.id === id);
            if (!emergency) {
                emergency = newsEmergencies.find(e => e.id === id);
            }
            
            if (emergency) {
                map.flyTo(emergency.coords, 15, {
                    duration: 1.5
                });
                currentMarkers.forEach(marker => {
                    const markerCoords = marker.getLatLng();
                    if (markerCoords.lat === emergency.coords[0] && markerCoords.lng === emergency.coords[1]) {
                        marker.openPopup();
                    }
                });
            }
        }
    </script>
</body>
</html>